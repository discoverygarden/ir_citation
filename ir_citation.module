<?php
/**
 * @file
 *   This is the main module file for the ir_citation module
 * @author
 *   William Panting
 * @todo
 *   put in access permissions?
 * @todo
 *   rename citeproc_json to something more meaningful like meta_data_object
 */

/**
 * The menu entries for this module.
 * @return $menu_entries
 *   An arrray of the items to be added to the drupal menu
 */
function ir_citation_menu() {
  $menu_entries= array();

  //demo page
  $menu_entries['citation demo']=array(
    'title' => 'citation demo',
    'description' => 'citation demo',
    'page callback' => 'ir_citation_cite',
    'access arguments' => array(),
    'type' => MENU_NORMAL_ITEM
  );
  return $menu_entries;
}

/**
 * This function will be the test be for citation generation.
 * It will generate the web page with citations.
 * @todo
 *   replace these add_js calls with custom wrapper functions
 */
function ir_citation_cite() {
  //init
  module_load_include('inc', 'ir_citation', 'ir_citation');

  $output.=test_api();

  ir_citation_run_demo_includes();
  //removed due to conflict with oo api
  //load_citeproc_javascript();
  
  //redo of citeproc's demo with mods->json conversion
  $output=$output . ir_citation_get_demo_html();
  
  return $output;
}

/**
 * This function is being used to test the api
 * @todo
 *   prep a test for finding aliases
 */
function test_api() {
  module_load_include('inc', 'ir_citation', 'ir_citation.api');
  $test= new IslandoraCitationAPI();
  $output='';
  
  //adding metadata from pid
  $alias='fedoraPidNewAPITest';
  $pid='Awill:258';
  //$test->addMetaData($alias, $pid, 'pid');
  
  //adding metadata from mods
  $alias='modsNewAPITest';
  $mods=file_get_contents(drupal_get_path('module', 'ir_citation') . '/demo/testMods.xml');
  $test->addMetaData($alias, $mods, 'mods');
  
  //strait in
  $type='abbreviation';
  $alias='abbreviationNewAPITest';
  $abbreviation_alias=$alias;
  $content='{"U.S. Bureau of the Census":"U.S. Bureau of the Census"}';
  $var_type="institution";
  $test->addData($type, $alias, $content, $var_type);
  $tmp=$test->getContent($alias);
  //dsm($tmp);
  
  $type='csl';
  $alias='cslNewAPITest';
  $csl_alias=$alias;
  $content="<style       xmlns=\"http://purl.org/net/xbiblio/csl\"      class=\"in-text\"      version=\"1.0\"	  default-locale=\"en-US-x-sort-ja-alalc97\">  <info>    <title>Chicago Manual of Style (Author-Date format)</title>    <id>http://www.zotero.org/styles/chicago-author-date</id>    <link rel=\"self\" href=\"http://www.zotero.org/styles/chicago-author-date\" />    <author>      <name>Julian Onions</name>      <email>julian.onions@gmail.com</email>    </author>    <category citation-format=\"author-date\" />    <category field=\"generic-base\" />    <updated>2009-08-10T04:49:00+09:00</updated>    <summary>The author-date variant of the Chicago style</summary>    <link href=\"http://www.chicagomanualofstyle.org/tools_citationguide.html\" rel=\"documentation\" />  </info>  <locale>    <terms>	  <term name=\"and others\"></term>      <term name=\"contributor\"></term>	</terms>  </locale>  <macro name=\"secondary-contributors\">    <choose>      <if match=\"none\" type=\"chapter\">        <group delimiter=\". \">          <choose>            <if variable=\"author\">              <names variable=\"editor\">                <label form=\"verb-short\" prefix=\" \" suffix=\". \" text-case=\"capitalize-first\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>          <choose>            <if match=\"any\" variable=\"author editor\">              <names variable=\"translator\">                <label form=\"verb-short\" prefix=\" \" suffix=\". \" text-case=\"capitalize-first\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>        </group>      </if>    </choose>  </macro>  <macro name=\"container-contributors\">    <choose>      <if type=\"chapter\">        <group delimiter=\", \" prefix=\",\">          <choose>            <if variable=\"author\">              <names variable=\"editor\">                <label form=\"verb-short\" prefix=\" \" suffix=\". \" text-case=\"lowercase\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>          <choose>            <if match=\"any\" variable=\"author editor\">              <names variable=\"translator\">                <label form=\"verb-short\" prefix=\" \" suffix=\". \" text-case=\"lowercase\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>        </group>      </if>    </choose>  </macro>  <macro name=\"anon\">    <choose>      <if match=\"none\" variable=\"author editor translator\">        <text form=\"short\" term=\"anonymous\" text-case=\"capitalize-first\" />      </if>    </choose>  </macro>  <macro name=\"editor\">    <names variable=\"editor\">      <name and=\"text\" delimiter=\", \" delimiter-precedes-last=\"always\" name-as-sort-order=\"first\" sort-separator=\", \" />      <label form=\"short\" prefix=\", \" suffix=\".\" />    </names>  </macro>  <macro name=\"translator\">    <names variable=\"translator\">      <name and=\"text\" delimiter=\", \" delimiter-precedes-last=\"always\" name-as-sort-order=\"first\" sort-separator=\", \" />      <label form=\"verb-short\" prefix=\", \" suffix=\".\" />    </names>  </macro>  <macro name=\"recipient\">    <choose>      <if type=\"personal_communication\">        <choose>          <if variable=\"genre\">            <text text-case=\"capitalize-first\" variable=\"genre\" />          </if>          <else>            <text term=\"letter\" text-case=\"capitalize-first\" />          </else>        </choose>      </if>    </choose>    <names delimiter=\", \" variable=\"recipient\">      <label form=\"verb\" prefix=\" \" suffix=\" \" text-case=\"lowercase\" />      <name and=\"text\" delimiter=\", \" />    </names>  </macro>  <macro name=\"contributors\">    <names variable=\"author\">      <name and=\"text\" delimiter=\", \" delimiter-precedes-last=\"always\" />      <label form=\"verb-short\" prefix=\", \" suffix=\".\" text-case=\"lowercase\" />      <substitute>        <text macro=\"editor\" />        <text macro=\"translator\" />      </substitute>    </names>    <text macro=\"anon\" />    <text macro=\"recipient\" />  </macro>  <macro name=\"headline-contributor\">    <names variable=\"contributor\">      <name and=\"text\" delimiter=\", \" 			delimiter-precedes-last=\"always\" 			name-as-sort-order=\"first\" 			sort-separator=\", \"  			et-al-use-first=\"1\" 			et-al-min=\"2\"/>	  <et-al term=\"and others\"/>      <label form=\"verb-short\" prefix=\", \" suffix=\".\" text-case=\"lowercase\" />    </names>  </macro>  <macro name=\"headline-author\">    <names variable=\"author\">      <name and=\"text\" delimiter=\", \" 			delimiter-precedes-last=\"always\" 			name-as-sort-order=\"first\" 			sort-separator=\", \"  			et-al-use-first=\"1\" 			et-al-min=\"2\"/>	  <et-al term=\"and others\"/>      <label form=\"verb-short\" prefix=\", \" suffix=\".\" text-case=\"lowercase\" />      <substitute>        <text macro=\"editor\" />        <text macro=\"translator\" />      </substitute>    </names>    <text macro=\"anon\" />    <text macro=\"recipient\" />  </macro>  <macro name=\"contributors-short\">    <names variable=\"author\">      <name and=\"text\" delimiter=\", \" form=\"short\" />      <substitute>        <names variable=\"editor\" />        <names variable=\"translator\" />      </substitute>    </names>    <text macro=\"anon\" />  </macro>  <macro name=\"interviewer\">    <names delimiter=\", \" variable=\"interviewer\">      <label form=\"verb\" prefix=\" \" suffix=\" \" text-case=\"capitalize-first\" />      <name and=\"text\" delimiter=\", \" />    </names>  </macro>  <macro name=\"archive\">    <group delimiter=\". \">      <text text-case=\"capitalize-first\" variable=\"archive_location\" />      <text variable=\"archive\" />      <text variable=\"archive-place\" />    </group>  </macro>  <macro name=\"access\">    <group delimiter=\". \">      <choose>        <if match=\"any\" type=\"graphic report\">          <text macro=\"archive\" />        </if>        <else-if match=\"none\" type=\"book thesis chapter article-journal article-newspaper article-magazine\">          <text macro=\"archive\" />        </else-if>      </choose>      <text prefix=\"doi:\" variable=\"DOI\" />      <text variable=\"URL\" />    </group>  </macro>  <macro name=\"title\">    <choose>      <if match=\"none\" variable=\"title\">        <choose>          <if match=\"none\" type=\"personal_communication\">            <text text-case=\"capitalize-first\" variable=\"genre\" />          </if>        </choose>      </if>      <else-if type=\"book\">        <text font-style=\"italic\" variable=\"title\" />      </else-if>      <else>        <text variable=\"title\" />      </else>    </choose>  </macro>  <macro name=\"edition\">    <choose>      <if match=\"any\" type=\"book chapter\">        <choose>          <if is-numeric=\"edition\">            <group delimiter=\" \">              <number form=\"ordinal\" variable=\"edition\" />              <text form=\"short\" suffix=\".\" term=\"edition\" />            </group>          </if>          <else>            <text suffix=\".\" variable=\"edition\" />          </else>        </choose>      </if>    </choose>  </macro>  <macro name=\"locators\">    <choose>      <if type=\"article-journal\">        <text prefix=\" \" variable=\"volume\" />        <text prefix=\", no. \" variable=\"issue\" />      </if>      <else-if type=\"book\">        <group delimiter=\". \" prefix=\". \">          <group>            <text form=\"short\" suffix=\". \" term=\"volume\" text-case=\"capitalize-first\" />            <number form=\"numeric\" variable=\"volume\" />          </group>          <group>            <number form=\"numeric\" variable=\"number-of-volumes\" />            <text form=\"short\" plural=\"true\" prefix=\" \" suffix=\".\" term=\"volume\" />          </group>        </group>      </else-if>    </choose>  </macro>  <macro name=\"locators-chapter\">    <choose>      <if type=\"chapter\">        <group prefix=\", \">          <text suffix=\":\" variable=\"volume\" />          <text variable=\"page\" />        </group>      </if>    </choose>  </macro>  <macro name=\"locators-article\">    <choose>      <if type=\"article-newspaper\">        <group delimiter=\", \" prefix=\", \">          <group>            <text suffix=\" \" variable=\"edition\" />            <text prefix=\" \" term=\"edition\" />          </group>          <group>            <text form=\"short\" suffix=\". \" term=\"section\" />            <text variable=\"section\" />          </group>        </group>      </if>      <else-if type=\"article-journal\">        <text prefix=\": \" variable=\"page\" />      </else-if>    </choose>  </macro>  <macro name=\"point-locators\">    <group>      <choose>        <if locator=\"page\" match=\"none\">          <label form=\"short\" strip-periods=\"false\" suffix=\" \" variable=\"locator\" />        </if>      </choose>      <text variable=\"locator\" />    </group>  </macro>  <macro name=\"container-prefix\">    <text term=\"in\" text-case=\"capitalize-first\" />  </macro>  <macro name=\"container-title\">    <choose>      <if type=\"chapter\">        <text macro=\"container-prefix\" suffix=\" \" />      </if>    </choose>    <text font-style=\"italic\" variable=\"container-title\" />  </macro>  <macro name=\"publisher\">    <group delimiter=\": \">      <text variable=\"publisher-place\" />      <text variable=\"publisher\" />    </group>  </macro>  <macro name=\"date\">    <date variable=\"issued\">      <date-part name=\"year\" />    </date>  </macro>  <macro name=\"day-month\">    <date variable=\"issued\">      <date-part name=\"month\" />      <date-part name=\"day\" prefix=\" \" />    </date>  </macro>  <macro name=\"collection-title\">    <text variable=\"collection-title\" />    <text prefix=\" \" variable=\"collection-number\" />  </macro>  <macro name=\"event\">    <group>      <text suffix=\" \" term=\"presented at\" />      <text variable=\"event\" />    </group>  </macro>  <macro name=\"description\">    <group delimiter=\". \">      <text macro=\"interviewer\" />      <text text-case=\"capitalize-first\" variable=\"medium\" />    </group>    <choose>      <if match=\"none\" variable=\"title\"> </if>      <else-if type=\"thesis\"> </else-if>      <else>        <text prefix=\". \" text-case=\"capitalize-first\" variable=\"genre\" />      </else>    </choose>  </macro>  <macro name=\"issue\">    <choose>      <if type=\"article-journal\">        <text macro=\"day-month\" prefix=\" (\" suffix=\")\" />      </if>      <else-if type=\"speech\">        <group delimiter=\", \" prefix=\" \">          <text macro=\"event\" />          <text macro=\"day-month\" />          <text variable=\"event-place\" />        </group>      </else-if>      <else-if match=\"any\" type=\"article-newspaper article-magazine\">        <text macro=\"day-month\" prefix=\", \" />      </else-if>      <else>        <group delimiter=\", \" prefix=\". \">          <choose>            <if type=\"thesis\">              <text text-case=\"capitalize-first\" variable=\"genre\" />            </if>          </choose>          <text macro=\"publisher\" />          <text macro=\"day-month\" />        </group>      </else>    </choose>  </macro>  <macro name=\"headline\">	<choose>	  <if variable=\"contributor\">		<text macro=\"headline-contributor\"/>	  </if>	  <else>		<text macro=\"headline-author\"/>	  </else>	</choose>  </macro>  <citation          disambiguate-add-givenname=\"true\"         disambiguate-add-names=\"true\"         disambiguate-add-year-suffix=\"true\"         et-al-min=\"4\"         et-al-subsequent-min=\"4\"         et-al-subsequent-use-first=\"1\"         et-al-use-first=\"1\">    <layout delimiter=\"; \" prefix=\"(\" suffix=\")\">      <group delimiter=\", \">        <group delimiter=\" \">          <text macro=\"contributors-short\" />          <text macro=\"date\" />        </group>        <text macro=\"point-locators\" />      </group>    </layout>  </citation>  <bibliography          entry-spacing=\"0\"         et-al-min=\"11\"         et-al-use-first=\"7\"         hanging-indent=\"true\"         subsequent-author-substitute=\"\">	<sort>	  <key macro=\"headline\" 		   names-min=\"1\" 		   names-use-first=\"1\" 		   sort=\"ascending\"/>	  <key variable=\"issued\"		   sort=\"descending\"/>	</sort>    <layout>      <text macro=\"headline\" display=\"block\"/>              <group display=\"left-margin\">        <text macro=\"date\" />	  </group>      <group display=\"right-inline\">        <group suffix=\".\">          <text macro=\"title\" />          <text macro=\"description\" />          <text macro=\"secondary-contributors\" prefix=\". \" />          <text macro=\"container-title\" prefix=\". \" />          <text macro=\"container-contributors\" />          <text macro=\"locators-chapter\" />          <text macro=\"edition\" prefix=\". \" />          <text macro=\"locators\" />          <text macro=\"collection-title\" prefix=\". \" />          <text macro=\"issue\" />          <text macro=\"locators-article\" />          <text macro=\"access\" prefix=\". \" />		</group>        <group prefix=\" (\" suffix=\")\" delimiter=\" \">          <choose>            <if variable=\"contributor\">              <text prefix=\"co-author among: \" macro=\"contributors\"/>			</if>            <else>  		      <text prefix=\"co-authorship: \" macro=\"contributors\"/>			</else>		  </choose>	    </group>	  </group>    </layout>  </bibliography></style>";
  $test->addData($type, $alias, $content);
  $test->getContent($alias);

  $type='metadata';
  $alias='metadataNewAPITest';
  //need to get api prefix
  $prefix= $test->getJavaScriptPrefix();
  $content='{
          "id": "' .
  $prefix . $alias . '",
          "title": "\u6c11\u6cd5",
  		"multi":{
  			"_keys":{
  				"title": {
  					"ja-alalc97": "Minp\u014d",
  					"en": "Japanese Civil Code"
  				}
  			}
  		},
          "type": "legislation"
      }';
  $test->addData($type, $alias, $content);
  $test->getContent($alias);  
  
  $meta_data_alias=$alias;//keep this after metadata
  
  $type='bibliography_list';
  $content=array($meta_data_alias);//keep this after metadata
  $alias='bibliography_listNewAPITest';
  $bibliography_list_alias=$alias;
  $test->addData($type, $alias, $content);
  $test->getContent($alias);
  
  
  $type='citation';
  $content='{
  	"citationItems": [
          {
  			"id":"' . $prefix . $meta_data_alias . '"
  		}
  	]}';
  $alias='citationNewAPITest';
  $test->addData($type, $alias, $content);
  $test->getContent($alias);
 
  $type='bibliography_selector';
  $alias='bibliography_selectorNewAPITest';
  $bibliography_selector_alias=$alias;
  $content='{"select" : [{"field" : "type","value" : "book"}]}';
  $test->addData($type, $alias, $content);
  $test->getContent($alias);
  
   //adding constructed basic citation
  $citation_object_alias='basicCitationNewAPITest';
  $test->loadBasicCitationObject($meta_data_alias, $citation_object_alias);
  
  
  $type='locale';
  $alias='localeNewAPITest';
  $content="<locale xml:lang=\"en\" xmlns=\"http://purl.org/net/xbiblio/csl\">  <style-options punctuation-in-quote=\"true\"/>  <date form=\"text\">    <date-part name=\"month\" suffix=\" \"/>    <date-part name=\"day\" suffix=\", \"/>    <date-part name=\"year\"/>  </date>  <date form=\"numeric\">    <date-part name=\"year\"/>    <date-part name=\"month\" form=\"numeric\" prefix=\"-\" range-delimiter=\"/\"/>    <date-part name=\"day\" prefix=\"-\" range-delimiter=\"/\"/>  </date>  <terms>    <term name=\"document-number-label\">No.</term>    <term name=\"document-number-authority-suffix\">Doc.</term>    <term name=\"un-sales-number-label\">U.N. Sales No.</term>    <term name=\"collection-number-label\">No.</term>    <term name=\"open-quote\">\u201c</term>    <term name=\"close-quote\">\u201d</term>    <term name=\"open-inner-quote\">\u2018</term>    <term name=\"close-inner-quote\">\u2019</term>    <term name=\"ordinal-01\">st</term>    <term name=\"ordinal-02\">nd</term>    <term name=\"ordinal-03\">rd</term>    <term name=\"ordinal-04\">th</term>    <term name=\"long-ordinal-01\">first</term>    <term name=\"long-ordinal-02\">second</term>    <term name=\"long-ordinal-03\">third</term>    <term name=\"long-ordinal-04\">fourth</term>    <term name=\"long-ordinal-05\">fifth</term>    <term name=\"long-ordinal-06\">sixth</term>    <term name=\"long-ordinal-07\">seventh</term>    <term name=\"long-ordinal-08\">eighth</term>    <term name=\"long-ordinal-09\">ninth</term>    <term name=\"long-ordinal-10\">tenth</term>    <term name=\"at\">at</term>    <term name=\"in\">in</term>    <term name=\"ibid\">ibid</term>    <term name=\"accessed\">accessed</term>    <term name=\"retrieved\">retrieved</term>    <term name=\"from\">from</term>    <term name=\"forthcoming\">forthcoming</term>    <term name=\"references\">      <single>reference</single>      <multiple>references</multiple>    </term>    <term name=\"references\" form=\"short\">      <single>ref</single>      <multiple>refs</multiple>    </term>    <term name=\"no date\">n.d.</term>    <term name=\"and\">and</term>    <term name=\"et-al\">et al.</term>    <term name=\"interview\">interview</term>    <term name=\"letter\">letter</term>    <term name=\"anonymous\">anonymous</term>    <term name=\"anonymous\" form=\"short\">anon.</term>    <term name=\"and others\">and others</term>    <term name=\"in press\">in press</term>    <term name=\"online\">online</term>    <term name=\"cited\">cited</term>    <term name=\"internet\">internet</term>    <term name=\"presented at\">presented at the</term>    <term name=\"ad\">AD</term>    <term name=\"bc\">BC</term>    <term name=\"season-01\">Spring</term>    <term name=\"season-02\">Summer</term>    <term name=\"season-03\">Autumn</term>    <term name=\"season-04\">Winter</term>    <term name=\"with\">with</term>        <!-- CATEGORIES -->    <term name=\"anthropology\">anthropology</term>    <term name=\"astronomy\">astronomy</term>    <term name=\"biology\">biology</term>    <term name=\"botany\">botany</term>    <term name=\"chemistry\">chemistry</term>    <term name=\"engineering\">engineering</term>    <term name=\"generic-base\">generic base</term>    <term name=\"geography\">geography</term>    <term name=\"geology\">geology</term>    <term name=\"history\">history</term>    <term name=\"humanities\">humanities</term>    <term name=\"literature\">literature</term>    <term name=\"math\">math</term>    <term name=\"medicine\">medicine</term>    <term name=\"philosophy\">philosophy</term>    <term name=\"physics\">physics</term>    <term name=\"psychology\">psychology</term>    <term name=\"sociology\">sociology</term>    <term name=\"science\">science</term>    <term name=\"political_science\">political science</term>    <term name=\"social_science\">social science</term>    <term name=\"theology\">theology</term>    <term name=\"zoology\">zoology</term>        <!-- LONG LOCATOR FORMS -->    <term name=\"book\">      <single>book</single>      <multiple>books</multiple>    </term>    <term name=\"chapter\">      <single>chapter</single>      <multiple>chapters</multiple>    </term>    <term name=\"column\">      <single>column</single>      <multiple>columns</multiple>    </term>    <term name=\"figure\">      <single>figure</single>      <multiple>figures</multiple>    </term>    <term name=\"folio\">      <single>folio</single>      <multiple>folios</multiple>    </term>    <term name=\"issue\">      <single>number</single>      <multiple>numbers</multiple>    </term>    <term name=\"line\">      <single>line</single>      <multiple>lines</multiple>    </term>    <term name=\"note\">      <single>note</single>      <multiple>notes</multiple>    </term>    <term name=\"opus\">      <single>opus</single>      <multiple>opera</multiple>    </term>    <term name=\"page\">      <single>page</single>      <multiple>pages</multiple>    </term>    <term name=\"paragraph\">      <single>paragraph</single>      <multiple>paragraph</multiple>    </term>    <term name=\"part\">      <single>part</single>      <multiple>parts</multiple>    </term>    <term name=\"section\">      <single>section</single>      <multiple>sections</multiple>    </term>    <term name=\"volume\">      <single>volume</single>      <multiple>volumes</multiple>    </term>    <term name=\"edition\">      <single>edition</single>      <multiple>editions</multiple>    </term>    <term name=\"verse\">      <single>verse</single>      <multiple>verses</multiple>    </term>    <term name=\"sub verbo\">      <single>sub verbo</single>      <multiple>s.vv</multiple>    </term>        <!-- SHORT LOCATOR FORMS -->    <term name=\"book\" form=\"short\">bk.</term>    <term name=\"chapter\" form=\"short\">chap.</term>    <term name=\"column\" form=\"short\">col.</term>    <term name=\"figure\" form=\"short\">fig.</term>    <term name=\"folio\" form=\"short\">f.</term>    <term name=\"issue\" form=\"short\">no.</term>    <term name=\"opus\" form=\"short\">op.</term>    <term name=\"page\" form=\"short\">      <single>p.</single>      <multiple>pp.</multiple>    </term>    <term name=\"paragraph\" form=\"short\">para.</term>    <term name=\"part\" form=\"short\">pt.</term>    <term name=\"section\" form=\"short\">sec.</term>    <term name=\"sub verbo\" form=\"short\">      <single>s.v.</single>      <multiple>s.vv.</multiple>    </term>    <term name=\"verse\" form=\"short\">      <single>v.</single>      <multiple>vv.</multiple>    </term>    <term name=\"volume\" form=\"short\">    	<single>vol.</single>    	<multiple>vols.</multiple>    </term>    <term name=\"edition\">edition</term>    <term name=\"edition\" form=\"short\">ed.</term>        <!-- SYMBOL LOCATOR FORMS -->    <term name=\"paragraph\" form=\"symbol\">      <single>¶</single>      <multiple>¶¶</multiple>    </term>    <term name=\"section\" form=\"symbol\">      <single>§</single>      <multiple>§§</multiple>    </term>        <!-- LONG ROLE FORMS -->    <term name=\"author\">      <single></single>      <multiple></multiple>    </term>    <term name=\"editor\">      <single>editor</single>      <multiple>editors</multiple>    </term>    <term name=\"translator\">      <single>translator</single>      <multiple>translators</multiple>    </term>        <!-- SHORT ROLE FORMS -->    <term name=\"author\" form=\"short\">      <single></single>      <multiple></multiple>    </term>    <term name=\"editor\" form=\"short\">      <single>ed.</single>      <multiple>eds.</multiple>    </term>    <term name=\"translator\" form=\"short\">      <single>tran.</single>      <multiple>trans.</multiple>    </term>        <!-- VERB ROLE FORMS -->    <term name=\"editor\" form=\"verb\">edited by</term>    <term name=\"translator\" form=\"verb\">translated by</term>    <term name=\"recipient\" form=\"verb\">to</term>    <term name=\"interviewer\" form=\"verb\">interview by</term>        <!-- SHORT VERB ROLE FORMS -->    <term name=\"editor\" form=\"verb-short\">ed.</term>    <term name=\"translator\" form=\"verb-short\">trans.</term>        <!-- LONG MONTH FORMS -->    <term name=\"month-01\">January</term>    <term name=\"month-02\">February</term>    <term name=\"month-03\">March</term>    <term name=\"month-04\">April</term>    <term name=\"month-05\">May</term>    <term name=\"month-06\">June</term>    <term name=\"month-07\">July</term>    <term name=\"month-08\">August</term>    <term name=\"month-09\">September</term>    <term name=\"month-10\">October</term>    <term name=\"month-11\">November</term>    <term name=\"month-12\">December</term>        <!-- SHORT MONTH FORMS -->    <term name=\"month-01\" form=\"short\">Jan.</term>    <term name=\"month-02\" form=\"short\">Feb.</term>    <term name=\"month-03\" form=\"short\">Mar.</term>    <term name=\"month-04\" form=\"short\">Apr.</term>	<term name=\"month-05\" form=\"short\">May</term>    <term name=\"month-06\" form=\"short\">Jun.</term>    <term name=\"month-07\" form=\"short\">Jul.</term>    <term name=\"month-08\" form=\"short\">Aug.</term>    <term name=\"month-09\" form=\"short\">Sep.</term>    <term name=\"month-10\" form=\"short\">Oct.</term>    <term name=\"month-11\" form=\"short\">Nov.</term>    <term name=\"month-12\" form=\"short\">Dec.</term>  </terms></locale>";
  $test->addData($type, $alias, $content);
  $test->getContent($alias);
  
  
  //test the SUPER AUTOMATIC FUNCTION
  /*
  $csl="<style       xmlns=\"http://purl.org/net/xbiblio/csl\"      class=\"in-text\"      version=\"1.0\"	  default-locale=\"en-US-x-sort-ja-alalc97\">  <info>    <title>Chicago Manual of Style (Author-Date format)</title>    <id>http://www.zotero.org/styles/chicago-author-date</id>    <link rel=\"self\" href=\"http://www.zotero.org/styles/chicago-author-date\" />    <author>      <name>Julian Onions</name>      <email>julian.onions@gmail.com</email>    </author>    <category citation-format=\"author-date\" />    <category field=\"generic-base\" />    <updated>2009-08-10T04:49:00+09:00</updated>    <summary>The author-date variant of the Chicago style</summary>    <link href=\"http://www.chicagomanualofstyle.org/tools_citationguide.html\" rel=\"documentation\" />  </info>  <locale>    <terms>	  <term name=\"and others\"></term>      <term name=\"contributor\"></term>	</terms>  </locale>  <macro name=\"secondary-contributors\">    <choose>      <if match=\"none\" type=\"chapter\">        <group delimiter=\". \">          <choose>            <if variable=\"author\">              <names variable=\"editor\">                <label form=\"verb-short\" prefix=\" \" suffix=\". \" text-case=\"capitalize-first\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>          <choose>            <if match=\"any\" variable=\"author editor\">              <names variable=\"translator\">                <label form=\"verb-short\" prefix=\" \" suffix=\". \" text-case=\"capitalize-first\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>        </group>      </if>    </choose>  </macro>  <macro name=\"container-contributors\">    <choose>      <if type=\"chapter\">        <group delimiter=\", \" prefix=\",\">          <choose>            <if variable=\"author\">              <names variable=\"editor\">                <label form=\"verb-short\" prefix=\" \" suffix=\". \" text-case=\"lowercase\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>          <choose>            <if match=\"any\" variable=\"author editor\">              <names variable=\"translator\">                <label form=\"verb-short\" prefix=\" \" suffix=\". \" text-case=\"lowercase\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>        </group>      </if>    </choose>  </macro>  <macro name=\"anon\">    <choose>      <if match=\"none\" variable=\"author editor translator\">        <text form=\"short\" term=\"anonymous\" text-case=\"capitalize-first\" />      </if>    </choose>  </macro>  <macro name=\"editor\">    <names variable=\"editor\">      <name and=\"text\" delimiter=\", \" delimiter-precedes-last=\"always\" name-as-sort-order=\"first\" sort-separator=\", \" />      <label form=\"short\" prefix=\", \" suffix=\".\" />    </names>  </macro>  <macro name=\"translator\">    <names variable=\"translator\">      <name and=\"text\" delimiter=\", \" delimiter-precedes-last=\"always\" name-as-sort-order=\"first\" sort-separator=\", \" />      <label form=\"verb-short\" prefix=\", \" suffix=\".\" />    </names>  </macro>  <macro name=\"recipient\">    <choose>      <if type=\"personal_communication\">        <choose>          <if variable=\"genre\">            <text text-case=\"capitalize-first\" variable=\"genre\" />          </if>          <else>            <text term=\"letter\" text-case=\"capitalize-first\" />          </else>        </choose>      </if>    </choose>    <names delimiter=\", \" variable=\"recipient\">      <label form=\"verb\" prefix=\" \" suffix=\" \" text-case=\"lowercase\" />      <name and=\"text\" delimiter=\", \" />    </names>  </macro>  <macro name=\"contributors\">    <names variable=\"author\">      <name and=\"text\" delimiter=\", \" delimiter-precedes-last=\"always\" />      <label form=\"verb-short\" prefix=\", \" suffix=\".\" text-case=\"lowercase\" />      <substitute>        <text macro=\"editor\" />        <text macro=\"translator\" />      </substitute>    </names>    <text macro=\"anon\" />    <text macro=\"recipient\" />  </macro>  <macro name=\"headline-contributor\">    <names variable=\"contributor\">      <name and=\"text\" delimiter=\", \" 			delimiter-precedes-last=\"always\" 			name-as-sort-order=\"first\" 			sort-separator=\", \"  			et-al-use-first=\"1\" 			et-al-min=\"2\"/>	  <et-al term=\"and others\"/>      <label form=\"verb-short\" prefix=\", \" suffix=\".\" text-case=\"lowercase\" />    </names>  </macro>  <macro name=\"headline-author\">    <names variable=\"author\">      <name and=\"text\" delimiter=\", \" 			delimiter-precedes-last=\"always\" 			name-as-sort-order=\"first\" 			sort-separator=\", \"  			et-al-use-first=\"1\" 			et-al-min=\"2\"/>	  <et-al term=\"and others\"/>      <label form=\"verb-short\" prefix=\", \" suffix=\".\" text-case=\"lowercase\" />      <substitute>        <text macro=\"editor\" />        <text macro=\"translator\" />      </substitute>    </names>    <text macro=\"anon\" />    <text macro=\"recipient\" />  </macro>  <macro name=\"contributors-short\">    <names variable=\"author\">      <name and=\"text\" delimiter=\", \" form=\"short\" />      <substitute>        <names variable=\"editor\" />        <names variable=\"translator\" />      </substitute>    </names>    <text macro=\"anon\" />  </macro>  <macro name=\"interviewer\">    <names delimiter=\", \" variable=\"interviewer\">      <label form=\"verb\" prefix=\" \" suffix=\" \" text-case=\"capitalize-first\" />      <name and=\"text\" delimiter=\", \" />    </names>  </macro>  <macro name=\"archive\">    <group delimiter=\". \">      <text text-case=\"capitalize-first\" variable=\"archive_location\" />      <text variable=\"archive\" />      <text variable=\"archive-place\" />    </group>  </macro>  <macro name=\"access\">    <group delimiter=\". \">      <choose>        <if match=\"any\" type=\"graphic report\">          <text macro=\"archive\" />        </if>        <else-if match=\"none\" type=\"book thesis chapter article-journal article-newspaper article-magazine\">          <text macro=\"archive\" />        </else-if>      </choose>      <text prefix=\"doi:\" variable=\"DOI\" />      <text variable=\"URL\" />    </group>  </macro>  <macro name=\"title\">    <choose>      <if match=\"none\" variable=\"title\">        <choose>          <if match=\"none\" type=\"personal_communication\">            <text text-case=\"capitalize-first\" variable=\"genre\" />          </if>        </choose>      </if>      <else-if type=\"book\">        <text font-style=\"italic\" variable=\"title\" />      </else-if>      <else>        <text variable=\"title\" />      </else>    </choose>  </macro>  <macro name=\"edition\">    <choose>      <if match=\"any\" type=\"book chapter\">        <choose>          <if is-numeric=\"edition\">            <group delimiter=\" \">              <number form=\"ordinal\" variable=\"edition\" />              <text form=\"short\" suffix=\".\" term=\"edition\" />            </group>          </if>          <else>            <text suffix=\".\" variable=\"edition\" />          </else>        </choose>      </if>    </choose>  </macro>  <macro name=\"locators\">    <choose>      <if type=\"article-journal\">        <text prefix=\" \" variable=\"volume\" />        <text prefix=\", no. \" variable=\"issue\" />      </if>      <else-if type=\"book\">        <group delimiter=\". \" prefix=\". \">          <group>            <text form=\"short\" suffix=\". \" term=\"volume\" text-case=\"capitalize-first\" />            <number form=\"numeric\" variable=\"volume\" />          </group>          <group>            <number form=\"numeric\" variable=\"number-of-volumes\" />            <text form=\"short\" plural=\"true\" prefix=\" \" suffix=\".\" term=\"volume\" />          </group>        </group>      </else-if>    </choose>  </macro>  <macro name=\"locators-chapter\">    <choose>      <if type=\"chapter\">        <group prefix=\", \">          <text suffix=\":\" variable=\"volume\" />          <text variable=\"page\" />        </group>      </if>    </choose>  </macro>  <macro name=\"locators-article\">    <choose>      <if type=\"article-newspaper\">        <group delimiter=\", \" prefix=\", \">          <group>            <text suffix=\" \" variable=\"edition\" />            <text prefix=\" \" term=\"edition\" />          </group>          <group>            <text form=\"short\" suffix=\". \" term=\"section\" />            <text variable=\"section\" />          </group>        </group>      </if>      <else-if type=\"article-journal\">        <text prefix=\": \" variable=\"page\" />      </else-if>    </choose>  </macro>  <macro name=\"point-locators\">    <group>      <choose>        <if locator=\"page\" match=\"none\">          <label form=\"short\" strip-periods=\"false\" suffix=\" \" variable=\"locator\" />        </if>      </choose>      <text variable=\"locator\" />    </group>  </macro>  <macro name=\"container-prefix\">    <text term=\"in\" text-case=\"capitalize-first\" />  </macro>  <macro name=\"container-title\">    <choose>      <if type=\"chapter\">        <text macro=\"container-prefix\" suffix=\" \" />      </if>    </choose>    <text font-style=\"italic\" variable=\"container-title\" />  </macro>  <macro name=\"publisher\">    <group delimiter=\": \">      <text variable=\"publisher-place\" />      <text variable=\"publisher\" />    </group>  </macro>  <macro name=\"date\">    <date variable=\"issued\">      <date-part name=\"year\" />    </date>  </macro>  <macro name=\"day-month\">    <date variable=\"issued\">      <date-part name=\"month\" />      <date-part name=\"day\" prefix=\" \" />    </date>  </macro>  <macro name=\"collection-title\">    <text variable=\"collection-title\" />    <text prefix=\" \" variable=\"collection-number\" />  </macro>  <macro name=\"event\">    <group>      <text suffix=\" \" term=\"presented at\" />      <text variable=\"event\" />    </group>  </macro>  <macro name=\"description\">    <group delimiter=\". \">      <text macro=\"interviewer\" />      <text text-case=\"capitalize-first\" variable=\"medium\" />    </group>    <choose>      <if match=\"none\" variable=\"title\"> </if>      <else-if type=\"thesis\"> </else-if>      <else>        <text prefix=\". \" text-case=\"capitalize-first\" variable=\"genre\" />      </else>    </choose>  </macro>  <macro name=\"issue\">    <choose>      <if type=\"article-journal\">        <text macro=\"day-month\" prefix=\" (\" suffix=\")\" />      </if>      <else-if type=\"speech\">        <group delimiter=\", \" prefix=\" \">          <text macro=\"event\" />          <text macro=\"day-month\" />          <text variable=\"event-place\" />        </group>      </else-if>      <else-if match=\"any\" type=\"article-newspaper article-magazine\">        <text macro=\"day-month\" prefix=\", \" />      </else-if>      <else>        <group delimiter=\", \" prefix=\". \">          <choose>            <if type=\"thesis\">              <text text-case=\"capitalize-first\" variable=\"genre\" />            </if>          </choose>          <text macro=\"publisher\" />          <text macro=\"day-month\" />        </group>      </else>    </choose>  </macro>  <macro name=\"headline\">	<choose>	  <if variable=\"contributor\">		<text macro=\"headline-contributor\"/>	  </if>	  <else>		<text macro=\"headline-author\"/>	  </else>	</choose>  </macro>  <citation          disambiguate-add-givenname=\"true\"         disambiguate-add-names=\"true\"         disambiguate-add-year-suffix=\"true\"         et-al-min=\"4\"         et-al-subsequent-min=\"4\"         et-al-subsequent-use-first=\"1\"         et-al-use-first=\"1\">    <layout delimiter=\"; \" prefix=\"(\" suffix=\")\">      <group delimiter=\", \">        <group delimiter=\" \">          <text macro=\"contributors-short\" />          <text macro=\"date\" />        </group>        <text macro=\"point-locators\" />      </group>    </layout>  </citation>  <bibliography          entry-spacing=\"0\"         et-al-min=\"11\"         et-al-use-first=\"7\"         hanging-indent=\"true\"         subsequent-author-substitute=\"\">	<sort>	  <key macro=\"headline\" 		   names-min=\"1\" 		   names-use-first=\"1\" 		   sort=\"ascending\"/>	  <key variable=\"issued\"		   sort=\"descending\"/>	</sort>    <layout>      <text macro=\"headline\" display=\"block\"/>              <group display=\"left-margin\">        <text macro=\"date\" />	  </group>      <group display=\"right-inline\">        <group suffix=\".\">          <text macro=\"title\" />          <text macro=\"description\" />          <text macro=\"secondary-contributors\" prefix=\". \" />          <text macro=\"container-title\" prefix=\". \" />          <text macro=\"container-contributors\" />          <text macro=\"locators-chapter\" />          <text macro=\"edition\" prefix=\". \" />          <text macro=\"locators\" />          <text macro=\"collection-title\" prefix=\". \" />          <text macro=\"issue\" />          <text macro=\"locators-article\" />          <text macro=\"access\" prefix=\". \" />		</group>        <group prefix=\" (\" suffix=\")\" delimiter=\" \">          <choose>            <if variable=\"contributor\">              <text prefix=\"co-author among: \" macro=\"contributors\"/>			</if>            <else>  		      <text prefix=\"co-authorship: \" macro=\"contributors\"/>			</else>		  </choose>	    </group>	  </group>    </layout>  </bibliography></style>";
  //citation
  //$auto_span=$test->getCitationHTMLFromPIDAndCSL($csl, array ('Awill:258'));
  //bibliography
  $auto_span=$test->getCitationHTMLFromPIDAndCSL($csl, array ('Awill:258','Awill:259'));
  $output.=$auto_span;
  */
  
  //get a bibliography
  $bib_span=$test->getCitationHTML($csl_alias, array('bibliography_list' => $bibliography_list_alias, 'citation' => NULL), 
    array('bibliography_slector' => NULL,
      'abbreviations' => $abbreviation_alias
      ));
  $output.=$bib_span;
  
  //get a citation
  $cite_span=$test->getCitationHTML($csl_alias, array('bibliography_list' => NULL, 'citation' => $citation_object_alias),array(
      'bibliography_slector' => NULL,
      'abbreviations' => $abbreviation_alias
      ));
  $output.=$cite_span;
  
  $test->addENUS();
  
  //stuff in here to test localization getters
  $lang="en-US";
  $locale="<locale xml:lang=\"en\" xmlns=\"http://purl.org/net/xbiblio/csl\">  <style-options punctuation-in-quote=\"true\"/>  <date form=\"text\">    <date-part name=\"month\" suffix=\" \"/>    <date-part name=\"day\" suffix=\", \"/>    <date-part name=\"year\"/>  </date>  <date form=\"numeric\">    <date-part name=\"year\"/>    <date-part name=\"month\" form=\"numeric\" prefix=\"-\" range-delimiter=\"/\"/>    <date-part name=\"day\" prefix=\"-\" range-delimiter=\"/\"/>  </date>  <terms>    <term name=\"document-number-label\">No.</term>    <term name=\"document-number-authority-suffix\">Doc.</term>    <term name=\"un-sales-number-label\">U.N. Sales No.</term>    <term name=\"collection-number-label\">No.</term>    <term name=\"open-quote\">\u201c</term>    <term name=\"close-quote\">\u201d</term>    <term name=\"open-inner-quote\">\u2018</term>    <term name=\"close-inner-quote\">\u2019</term>    <term name=\"ordinal-01\">st</term>    <term name=\"ordinal-02\">nd</term>    <term name=\"ordinal-03\">rd</term>    <term name=\"ordinal-04\">th</term>    <term name=\"long-ordinal-01\">first</term>    <term name=\"long-ordinal-02\">second</term>    <term name=\"long-ordinal-03\">third</term>    <term name=\"long-ordinal-04\">fourth</term>    <term name=\"long-ordinal-05\">fifth</term>    <term name=\"long-ordinal-06\">sixth</term>    <term name=\"long-ordinal-07\">seventh</term>    <term name=\"long-ordinal-08\">eighth</term>    <term name=\"long-ordinal-09\">ninth</term>    <term name=\"long-ordinal-10\">tenth</term>    <term name=\"at\">at</term>    <term name=\"in\">in</term>    <term name=\"ibid\">ibid</term>    <term name=\"accessed\">accessed</term>    <term name=\"retrieved\">retrieved</term>    <term name=\"from\">from</term>    <term name=\"forthcoming\">forthcoming</term>    <term name=\"references\">      <single>reference</single>      <multiple>references</multiple>    </term>    <term name=\"references\" form=\"short\">      <single>ref</single>      <multiple>refs</multiple>    </term>    <term name=\"no date\">n.d.</term>    <term name=\"and\">and</term>    <term name=\"et-al\">et al.</term>    <term name=\"interview\">interview</term>    <term name=\"letter\">letter</term>    <term name=\"anonymous\">anonymous</term>    <term name=\"anonymous\" form=\"short\">anon.</term>    <term name=\"and others\">and others</term>    <term name=\"in press\">in press</term>    <term name=\"online\">online</term>    <term name=\"cited\">cited</term>    <term name=\"internet\">internet</term>    <term name=\"presented at\">presented at the</term>    <term name=\"ad\">AD</term>    <term name=\"bc\">BC</term>    <term name=\"season-01\">Spring</term>    <term name=\"season-02\">Summer</term>    <term name=\"season-03\">Autumn</term>    <term name=\"season-04\">Winter</term>    <term name=\"with\">with</term>        <!-- CATEGORIES -->    <term name=\"anthropology\">anthropology</term>    <term name=\"astronomy\">astronomy</term>    <term name=\"biology\">biology</term>    <term name=\"botany\">botany</term>    <term name=\"chemistry\">chemistry</term>    <term name=\"engineering\">engineering</term>    <term name=\"generic-base\">generic base</term>    <term name=\"geography\">geography</term>    <term name=\"geology\">geology</term>    <term name=\"history\">history</term>    <term name=\"humanities\">humanities</term>    <term name=\"literature\">literature</term>    <term name=\"math\">math</term>    <term name=\"medicine\">medicine</term>    <term name=\"philosophy\">philosophy</term>    <term name=\"physics\">physics</term>    <term name=\"psychology\">psychology</term>    <term name=\"sociology\">sociology</term>    <term name=\"science\">science</term>    <term name=\"political_science\">political science</term>    <term name=\"social_science\">social science</term>    <term name=\"theology\">theology</term>    <term name=\"zoology\">zoology</term>        <!-- LONG LOCATOR FORMS -->    <term name=\"book\">      <single>book</single>      <multiple>books</multiple>    </term>    <term name=\"chapter\">      <single>chapter</single>      <multiple>chapters</multiple>    </term>    <term name=\"column\">      <single>column</single>      <multiple>columns</multiple>    </term>    <term name=\"figure\">      <single>figure</single>      <multiple>figures</multiple>    </term>    <term name=\"folio\">      <single>folio</single>      <multiple>folios</multiple>    </term>    <term name=\"issue\">      <single>number</single>      <multiple>numbers</multiple>    </term>    <term name=\"line\">      <single>line</single>      <multiple>lines</multiple>    </term>    <term name=\"note\">      <single>note</single>      <multiple>notes</multiple>    </term>    <term name=\"opus\">      <single>opus</single>      <multiple>opera</multiple>    </term>    <term name=\"page\">      <single>page</single>      <multiple>pages</multiple>    </term>    <term name=\"paragraph\">      <single>paragraph</single>      <multiple>paragraph</multiple>    </term>    <term name=\"part\">      <single>part</single>      <multiple>parts</multiple>    </term>    <term name=\"section\">      <single>section</single>      <multiple>sections</multiple>    </term>    <term name=\"volume\">      <single>volume</single>      <multiple>volumes</multiple>    </term>    <term name=\"edition\">      <single>edition</single>      <multiple>editions</multiple>    </term>    <term name=\"verse\">      <single>verse</single>      <multiple>verses</multiple>    </term>    <term name=\"sub verbo\">      <single>sub verbo</single>      <multiple>s.vv</multiple>    </term>        <!-- SHORT LOCATOR FORMS -->    <term name=\"book\" form=\"short\">bk.</term>    <term name=\"chapter\" form=\"short\">chap.</term>    <term name=\"column\" form=\"short\">col.</term>    <term name=\"figure\" form=\"short\">fig.</term>    <term name=\"folio\" form=\"short\">f.</term>    <term name=\"issue\" form=\"short\">no.</term>    <term name=\"opus\" form=\"short\">op.</term>    <term name=\"page\" form=\"short\">      <single>p.</single>      <multiple>pp.</multiple>    </term>    <term name=\"paragraph\" form=\"short\">para.</term>    <term name=\"part\" form=\"short\">pt.</term>    <term name=\"section\" form=\"short\">sec.</term>    <term name=\"sub verbo\" form=\"short\">      <single>s.v.</single>      <multiple>s.vv.</multiple>    </term>    <term name=\"verse\" form=\"short\">      <single>v.</single>      <multiple>vv.</multiple>    </term>    <term name=\"volume\" form=\"short\">    	<single>vol.</single>    	<multiple>vols.</multiple>    </term>    <term name=\"edition\">edition</term>    <term name=\"edition\" form=\"short\">ed.</term>        <!-- SYMBOL LOCATOR FORMS -->    <term name=\"paragraph\" form=\"symbol\">      <single>¶</single>      <multiple>¶¶</multiple>    </term>    <term name=\"section\" form=\"symbol\">      <single>§</single>      <multiple>§§</multiple>    </term>        <!-- LONG ROLE FORMS -->    <term name=\"author\">      <single></single>      <multiple></multiple>    </term>    <term name=\"editor\">      <single>editor</single>      <multiple>editors</multiple>    </term>    <term name=\"translator\">      <single>translator</single>      <multiple>translators</multiple>    </term>        <!-- SHORT ROLE FORMS -->    <term name=\"author\" form=\"short\">      <single></single>      <multiple></multiple>    </term>    <term name=\"editor\" form=\"short\">      <single>ed.</single>      <multiple>eds.</multiple>    </term>    <term name=\"translator\" form=\"short\">      <single>tran.</single>      <multiple>trans.</multiple>    </term>        <!-- VERB ROLE FORMS -->    <term name=\"editor\" form=\"verb\">edited by</term>    <term name=\"translator\" form=\"verb\">translated by</term>    <term name=\"recipient\" form=\"verb\">to</term>    <term name=\"interviewer\" form=\"verb\">interview by</term>        <!-- SHORT VERB ROLE FORMS -->    <term name=\"editor\" form=\"verb-short\">ed.</term>    <term name=\"translator\" form=\"verb-short\">trans.</term>        <!-- LONG MONTH FORMS -->    <term name=\"month-01\">January</term>    <term name=\"month-02\">February</term>    <term name=\"month-03\">March</term>    <term name=\"month-04\">April</term>    <term name=\"month-05\">May</term>    <term name=\"month-06\">June</term>    <term name=\"month-07\">July</term>    <term name=\"month-08\">August</term>    <term name=\"month-09\">September</term>    <term name=\"month-10\">October</term>    <term name=\"month-11\">November</term>    <term name=\"month-12\">December</term>        <!-- SHORT MONTH FORMS -->    <term name=\"month-01\" form=\"short\">Jan.</term>    <term name=\"month-02\" form=\"short\">Feb.</term>    <term name=\"month-03\" form=\"short\">Mar.</term>    <term name=\"month-04\" form=\"short\">Apr.</term>	<term name=\"month-05\" form=\"short\">May</term>    <term name=\"month-06\" form=\"short\">Jun.</term>    <term name=\"month-07\" form=\"short\">Jul.</term>    <term name=\"month-08\" form=\"short\">Aug.</term>    <term name=\"month-09\" form=\"short\">Sep.</term>    <term name=\"month-10\" form=\"short\">Oct.</term>    <term name=\"month-11\" form=\"short\">Nov.</term>    <term name=\"month-12\" form=\"short\">Dec.</term>  </terms></locale>";
  $tmp=$test->getLocals();
  //dsm($tmp);
  $tmp=$test->getLocalizationString($lang);
  //dsm($tmp);
  $tmp=$test->getLocalizationAlias($locale);
  //dsm($tmp);
  
  
  $test->loadCiteprocJavascript();
  
  return $output;
}

/**
 * This funciton will include all the variables in javascript needed for the demo.
 * It uses the module's API.
 * The data came from the citeproc-js demo
 */
function ir_citation_run_demo_includes() {
  module_load_include('inc', 'ir_citation', 'ir_citation');
  //demo case
  
  //bibliography lists
  load_bibliography_list_for_javascript(array("ITEM-1", "ITEM-3", "ITEM-4", "ITEM-5", "ITEM-6", "ITEM-7", "ITEM-8", "ITEM-9"), 'chicago_author_date_listing');

  load_bibliography_list_for_javascript(array("ITEM-1", "ITEM-2", "ITEM-3", "ITEM-4", "ITEM-5", "ITEM-6"), 'ieee');

  load_bibliography_list_for_javascript(array("ITEM-1", "ITEM-2", "ITEM-3", "ITEM-4", "ITEM-5", "ITEM-6"), 'chicago_fullnote_bibliography2');
  
  $bibliography_selector='{"select" : [{"field" : "type","value" : "book"}]}';
  $variable_name='test';
  load_bibliography_selector($bibliography_selector, $variable_name);
  
  //citation objects
  $variable_name='citationCAD1';
  $json='{"citationItems":[{"id":"ITEM-1"}],"properties":{"noteIndex": 1}}';
  load_citeproc_citation_object_for_javascript($json, $variable_name);
  
  $variable_name='citationCAD2';
  $json='{
	"citationItems": [
        {
			"id": "ITEM-2"
		}
	],
	"properties": {
		"noteIndex": 2
	}}';
  load_citeproc_citation_object_for_javascript($json, $variable_name);
  
  $variable_name='citationCAD3';
  $json='{
	"citationItems": [
        {
			"id": "ITEM-3"
		}
	],
	"properties": {
		"noteIndex": 3
	}}';
  load_citeproc_citation_object_for_javascript($json, $variable_name);
  
  $variable_name='citationCAD4';
  $json='{
	"citationItems": [
        {
			"id": "ITEM-4"
		}
	],
	"properties": {
		"noteIndex": 4
	}
}';
  load_citeproc_citation_object_for_javascript($json, $variable_name);
  
  $variable_name='citationCAD5';
  $json='{
	"citationItems": [
        {
			"id": "ITEM-5"
		}
	],
	"properties": {
		"noteIndex": 5
	}
}';
  load_citeproc_citation_object_for_javascript($json, $variable_name);
  
  $variable_name='citationCAD6';
  $json='{
	"citationItems": [
        {
			"id": "ITEM-6"
		}
	],
	"properties": {
		"noteIndex": 6
	}
}';
  load_citeproc_citation_object_for_javascript($json, $variable_name);
  
  $variable_name='citationCAD7';
  $json='{
	"citationItems": [
        {
			"id": "ITEM-21"
		}
	],
	"properties": {
		"noteIndex": 7
	}
}';
  load_citeproc_citation_object_for_javascript($json, $variable_name);
  
  $variable_name='citationBB1';
  $json='{
	"citationItems": [
        {
			"id": "ITEM-6",
			"label": "page",
			"locator": "223"
		}
	],
	"properties": {
		"noteIndex": 1
	}
}';
  load_citeproc_citation_object_for_javascript($json, $variable_name);
  
  $variable_name='citationBB2';
  $json='{
	"citationItems": [
        {
			"id": "ITEM-6"
		},
        {
			"id": "ITEM-10",
			"label": "page",
			"locator": "685"
		},
        {
			"id": "ITEM-11",
			"label": "page",
			"locator": "388"
		},
        {
			"id": "ITEM-12",
			"label": "page",
			"locator": "359"
		},
        {
			"id": "ITEM-10",
			"label": "page",
			"locator": "690"
		},
        {
			"id": "ITEM-11",
			"label": "page",
			"locator": "393"
		},
        {
			"id": "ITEM-12",
			"label": "page",
			"locator": "364"
		},
        {
			"id": "ITEM-6",
			"locator": "15",
			"prefix":"<i>but see</i>"
		}
	],
	"properties": {
		"noteIndex": 2
	}
}';
  load_citeproc_citation_object_for_javascript($json, $variable_name);
  
  $variable_name='citationBB3';
  $json='{
	"citationItems": [
        {
			"id": "ITEM-13",
			"locator":"90",
			"label":"section"
		},
        {
			"id": "ITEM-14",
			"locator":"7",
			"label":"section"
		},
        {
			"id": "ITEM-15",
			"locator":"731-32",
			"label":"page"
		},
        {
			"id": "ITEM-16"
		}
	],
	"properties": {
		"noteIndex": 3
	}
}';
  load_citeproc_citation_object_for_javascript($json, $variable_name);
  
  $variable_name='citationBB4';
  $json='{
	"citationItems": [
        {
			"id": "ITEM-2"
		}
	],
	"properties": {
		"noteIndex": 4
	}
}';
  load_citeproc_citation_object_for_javascript($json, $variable_name);
  
  $variable_name='citationBB5';
  $json='{
	"citationItems": [
        {
			"id": "ITEM-2",
			"label":"page",
			"locator":"482"
		},
        {
			"id": "ITEM-13",
			"locator":"395",
			"label":"section"
		},
        {
			"id": "ITEM-1",
			"label":"page",
			"locator":"25"
		},
        {
			"id": "ITEM-1"
		},
        {
			"id": "ITEM-1",
			"label":"page",
			"locator":"112"
		}
	],
	"properties": {
		"noteIndex": 5
	}
}';
  load_citeproc_citation_object_for_javascript($json, $variable_name);
  
  $variable_name='citationBB6';
  $json='{
	"citationItems": [
        {
			"id": "ITEM-16"
		}
	],
	"properties": {
		"noteIndex": 6
	}
}';
  load_citeproc_citation_object_for_javascript($json, $variable_name);
  
  $variable_name='citationBB7';
  $json='{
	"citationItems": [
        {
			"id": "ITEM-17",
			"label":"paragraph",
			"locator":"6"
		},
        {
			"id": "ITEM-18",
			"label":"page",
			"locator":"983"
		}
	],
	"properties": {
		"noteIndex": 7
	}
}';
  load_citeproc_citation_object_for_javascript($json, $variable_name);
  
  $variable_name='citationBB8';
  $json='{
	"citationItems": [
        {
			"id": "ITEM-19",
			"suffix":"(appeal taken from Scot.)"
		}
	],
	"properties": {
		"noteIndex": 8
	}
}';
  load_citeproc_citation_object_for_javascript($json, $variable_name);
  
  $variable_name='citationBB9';
  $json='{
	"citationItems": [
        {
			"id": "ITEM-20",
			"suffix":"(appeal taken from B.C.)"
		}
	],
	"properties": {
		"noteIndex": 9
	}
}';
  load_citeproc_citation_object_for_javascript($json, $variable_name);
  
  $variable_name='citationBB10';
  $json='{
	"citationItems": [
        {
			"id": "ITEM-3",
			"prefix":"<b>En sinn Scholl beschéngt ass, da Mamm frësch blénken hun?</b> <i>See, e.g.</i>"
		},
        {
			"prefix":"<b>Der mä gutt Dach, eng onser bléit geplot mä.</b>  <i>See generally</i>",
			"id": "ITEM-3",
			"suffix":"<b>(Iwer Engel Milliounen nei fu, blëtzen néierens d\'Gaassen rou do.)</b>"
		}
	],
	"properties": {
		"noteIndex": 10
	}
}';
  load_citeproc_citation_object_for_javascript($json, $variable_name);
  
  $variable_name='citationBB11';
  $json='{
	"citationItems": [
        {
			"id": "ITEM-13",
			"label":"section",
			"locator":"1"
		}
	],
	"properties": {
		"noteIndex": 11
	}
}';
  load_citeproc_citation_object_for_javascript($json, $variable_name);

  
  
  
  //mods to json
  $variable_name='ITEM-21';
  $cite_mods=file_get_contents(drupal_get_path('module', 'ir_citation') . '/demo/testMods.xml');
  load_citeproc_json_from_mods($variable_name, $cite_mods);

  //fedora grab test [success]
  //load_meta_data_from_fedora_pid('Awill:258', $variable_name);
  
  //strait json
  $variable_name='ITEM-1';
  $citeproc_json='{
		"id": "ITEM-1",
		"title":"Boundaries of Dissent: Protest and State Power in the Media Age",
		"author": [
			{
				"family": "D\'Arcus",
				"given": "Bruce",
				"static-ordering": false
			}
		],
        "note":"The apostrophe in Bruce\'s name appears in proper typeset form.",
		"publisher": "Routledge",
        "publisher-place": "New York",
		"issued": {
			"date-parts":[
				[2006]
			]
		},
		"type": "book"
	}';
  load_metadata_object_for_javascript($variable_name, $citeproc_json);
  
  $variable_name='ITEM-2';
  $citeproc_json='{
		"id": "ITEM-2",
		"author": [
			{
				"family": "Barnett",
				"given": "Frank G.",
				"suffix": "Jr.",
				"comma-suffix": true,
				"static-ordering": false
			}
		],
		"title":"Getting Property Right: \"Informal\" Mortgages in the Japanese Courts",
		"container-title":"Pacific Rim Law & Policy Journal",
		"volume": "18",
		"page": "463-509",
		"issued": {
			"date-parts":[
				[2009, 8]
			]
		},
		"type": "article-journal",
        "note": "Note the flip-flop behavior of the quotations marks around \"informal\" in the title of this citation.  This works for quotation marks in any style locale.  Oh, and, uh, these notes illustrate the formatting of annotated bibliographies (!)."
	}';
  load_metadata_object_for_javascript($variable_name, $citeproc_json);
  
  $variable_name='ITEM-3';
  $citeproc_json='{
		"id": "ITEM-3",
		"title":"Key Process Conditions for Production of C<sub>4</sub> Dicarboxylic Acids in Bioreactor Batch Cultures of an Engineered <i>Saccharomyces cerevisiae</i> Strain",
        "note":"This cite illustrates the rich text formatting capabilities in the new processor, as well as page range collapsing (in this case, applying the collapsing method required by the Chicago Manual of Style).  Also, as the IEEE example above partially illustrates, we also offer robust handling of particles such as \"van\" and \"de\" in author names.",
		"author": [
			{
				"family": "Zelle",
				"given": "Rintze M."
			},
			{
				"family": "Hulster",
				"given": "Erik",
				"non-dropping-particle":"de"
			},
			{
				"family": "Kloezen",
				"given": "Wendy"
			},
			{
				"family":"Pronk",
				"given":"Jack T."
			},
			{
				"family": "Maris",
				"given":"Antonius J.A.",
				"non-dropping-particle":"van"
			}
		],
		"container-title": "Applied and Environmental Microbiology",
		"issued":{
			"date-parts":[
				[2010, 2]
			]
		},
		"page": "744-750",
		"volume":"76",
		"issue": "3",
		"DOI":"10.1128/AEM.02396-09",
		"type": "article-journal"
	}';
  load_metadata_object_for_javascript($variable_name, $citeproc_json);
  
  $variable_name='ITEM-4';
  $citeproc_json='{
		"id": "ITEM-4",
		"author": [
			{
				"family": "Razlogova",
				"given": "Elena"
			}
		],
		"title": "Radio and Astonishment: The Emergence of Radio Sound, 1920-1926",
		"type": "speech",
		"event": "Society for Cinema Studies Annual Meeting",
		"event-place": "Denver, CO",
        "note":"All styles in the CSL repository are supported by the new processor, including the popular Chicago styles by Elena.",
		"issued": {
			"date-parts": [
				[
					2002,
					5
				]
			]
		}
	}';
  load_metadata_object_for_javascript($variable_name, $citeproc_json);
  
  $variable_name='ITEM-5';
  $citeproc_json='{
		"id": "ITEM-5",
		"author": [
			{
				"family": "\u68b6\u7530",
				"given": "\u5c06\u53f8",
				"multi":{
					"_key":{
						"ja-alalc97":{
								"family": "Kajita",
								"given": "Shoji"
						}
					}
				}				
			},
			{
				"family": "\u89d2\u6240",
				"given": "\u8003",
				"multi":{
					"_key":{
						"ja-alalc97":{
							"family": "Kakusho",
							"given": "Takashi"
						}
					}
				}				
			},
			{
				"family": "\u4e2d\u6fa4",
				"given": "\u7be4\u5fd7",
				"multi":{
					"_key":{
						"ja-alalc97":{
							"family": "Nakazawa",
							"given": "Atsushi"
						}
					}
				}				
			},
			{
				"family": "\u7af9\u6751",
				"given": "\u6cbb\u96c4",
				"multi":{
					"_key":{
						"ja-alalc97":{
							"family": "Takemura",
							"given": "Haruo"
						}
					}
				}				
			},
			{
				"family": "\u7f8e\u6fc3",
				"given": "\u5c0e\u5f66",
				"multi":{
					"_key":{
						"ja-alalc97":{
							"family": "Mino",
							"given": "Michihiko"
						}
					}
				}				
			},
			{
				"family": "\u9593\u702c",
				"given": "\u5065\u4e8c",
				"multi":{
					"_key":{
						"ja-alalc97":{
							"family": "Mase",
							"given": "Kenji"
						}
					}
				}				
			}
		],
		"title": "\u9ad8\u7b49\u6559\u80b2\u6a5f\u95a2\u306b\u304a\u3051\u308b\u6b21\u4e16\u4ee3\u6559\u80b2\u5b66\u7fd2\u652f\u63f4\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u306e\u69cb\u7bc9\u306b\u5411\u3051\u3066",
		"multi":{
			"_keys":{
				"title":{
					"ja-alalc97": "K\u014dt\u014d ky\u014diku ni okeru jisedai ky\u014diku gakush\u016b shien puratto f\u014dmu no k\u014dchiku ni mukete",
					"en": "Toward the Development of Next-Generation Platforms for Teaching and Learning in Higher Education"
				},
				"container-title":{
					"ja-alalc97": "Nihon ky\u014diku k\u014dgaku ronbunshi",
					"en": "Journal of the Japan Educational Engineering Society"
				}
			}
		},
		"container-title": "\u65e5\u672c\u6559\u80b2\u5de5\u5b66\u4f1a\u8ad6\u6587\u8a8c",
		"volume": "31",
		"issue": "3",
		"page": "297-305",
		"issued": {
			"date-parts": [
				[
					2007,
					12
				]
			]
		},
        "note": "Note the transformations to which this cite is subjected in the samples above, and the fact that it appears in the correct sort position in all rendered forms.  Selection of multi-lingual content can be configured in the style, permitting one database to serve a multi-lingual author in all languages in which she might publish.",
		"type": "article-journal"

	}';
  load_metadata_object_for_javascript($variable_name, $citeproc_json);
  
  $variable_name='ITEM-6';
  $citeproc_json='{
		"id": "ITEM-6",
		"title":"Evaluating Components of International Migration: Consistency of 2000 Nativity Data",
		"note": "This cite illustrates the formatting of institutional authors.  Note that there is no \"and\" between the individual author and the institution with which he is affiliated.",
		"author": [
			{
				"family": "Malone",
				"given": "Nolan J.",
				"static-ordering": false
			},
			{
				"literal": "U.S. Bureau of the Census"
			}
		],
		"publisher": "Routledge",
        "publisher-place": "New York",
		"issued": {
			"date-parts":[
				[2001, 12, 5]
			]
		},
		"type": "book"
	}';
  load_metadata_object_for_javascript($variable_name, $citeproc_json);
  
  $variable_name='ITEM-7';
  $citeproc_json='{
		"id": "ITEM-7",
		"title": "True Crime Radio and Listener Disenchantment with Network Broadcasting, 1935-1946",
		"author":[
			{
				"family": "Razlogova",
				"given": "Elena"
			}
		],
		"container-title": "American Quarterly",
		"volume": "58",
		"page": "137-158",
		"issued": {
			"date-parts": [
				[2006, 3]
			]
		},
		"type": "article-journal"
	}';
  load_metadata_object_for_javascript($variable_name, $citeproc_json);
  
  $variable_name='ITEM-8';
  $citeproc_json='{
		"id": "ITEM-8",
		"title": "The Guantanamobile Project",
		"container-title": "Vectors",
		"volume": "1",
		"author":[
			{
				"family": "Razlogova",
				"given": "Elena"
			},
			{
				"family": "Lynch",
				"given": "Lisa"
			}
		],
		"issued": {
			"season": 3,
			"date-parts": [
				[2005]
			]
		},
		"type": "article-journal"

	}';
  load_metadata_object_for_javascript($variable_name, $citeproc_json);
  
  $variable_name='ITEM-9';
  $citeproc_json='{
		"id": "ITEM-9",
		"container-title": "FEMS Yeast Research",
		"volume": "9",
		"issue": "8",
		"page": "1123-1136",
		"title": "Metabolic engineering of <i>Saccharomyces cerevisiae</i> for production of carboxylic acids: current status and challenges",
		"contributor":[
			{
				"family": "Zelle",
				"given": "Rintze M."
			}
		],
		"author": [
			{
				"family": "Abbott",
				"given": "Derek A."
			},
			{
				"family": "Zelle",
				"given": "Rintze M."
			},
			{
				"family":"Pronk",
				"given":"Jack T."
			},
			{
				"family": "Maris",
				"given":"Antonius J.A.",
				"non-dropping-particle":"van"
			}
		],
		"issued": {
			"season": "2",
			"date-parts": [
				[
					2009,
					6,
					6
				]
			]
		},
		"type": "article-journal"
	}';
  load_metadata_object_for_javascript($variable_name, $citeproc_json);
  
  $variable_name='ITEM-10';
  $citeproc_json='{
        "container-title": "N.Y.2d", 
        "id": "ITEM-10", 
        "issued": {
            "date-parts": [
                [
                    "1989"
                ]
            ]
        }, 
        "page": "683", 
        "title": "People v. Taylor", 
        "type": "legal_case", 
        "volume": 73
    }';
  load_metadata_object_for_javascript($variable_name, $citeproc_json);
  
  $variable_name='ITEM-11';
  $citeproc_json='{
        "container-title": "N.E.2d", 
        "id": "ITEM-11", 
        "issued": {
            "date-parts": [
                [
                    "1989"
                ]
            ]
        }, 
        "page": "386", 
        "title": "People v. Taylor", 
        "type": "legal_case", 
        "volume": 541
    }';
  load_metadata_object_for_javascript($variable_name, $citeproc_json);
  
  $variable_name='ITEM-12';
  $citeproc_json='{
        "container-title": "N.Y.S.2d", 
        "id": "ITEM-12", 
        "issued": {
            "date-parts": [
                [
                    "1989"
                ]
            ]
        }, 
        "page": "357", 
        "title": "People v. Taylor", 
        "type": "legal_case", 
        "volume": 543
    }';
  load_metadata_object_for_javascript($variable_name, $citeproc_json);
  
  $variable_name='ITEM-13';
  $citeproc_json='{
        "id": "ITEM-13", 
        "title": "\u6c11\u6cd5",
		"multi":{
			"_keys":{
				"title": {
					"ja-alalc97": "Minp\u014d",
					"en": "Japanese Civil Code"
				}
			}
		},
        "type": "legislation"
    }';
  load_metadata_object_for_javascript($variable_name, $citeproc_json);
  
  $variable_name='ITEM-14';
  $citeproc_json='{
        "id": "ITEM-14", 
        "title": "Clayton Act",
        "container-title": "ch.",
        "number": 323,
		"issued": {
           "date-parts": [
             [
                1914
             ]
           ]
		},
        "type": "legislation"
    }';
  load_metadata_object_for_javascript($variable_name, $citeproc_json);
  
  $variable_name='ITEM-15';
  $citeproc_json='{
        "id": "ITEM-15", 
        "title": "Clayton Act",
		"volume":38,
        "container-title": "Stat.",
        "page": 730,
		"issued": {
           "date-parts": [
             [
                1914
             ]
           ]
		},
        "type": "legislation"
    }';
  load_metadata_object_for_javascript($variable_name, $citeproc_json);
  
  $variable_name='ITEM-16';
  $citeproc_json='{
        "id": "ITEM-16", 
        "title": "FTC Credit Practices Rule",
		"volume":16,
        "container-title": "C.F.R.",
        "section": 444,
		"issued": {
           "date-parts": [
             [
                1999
             ]
           ]
		},
        "type": "legislation"
    }';
  load_metadata_object_for_javascript($variable_name, $citeproc_json);
  
  $variable_name='ITEM-17';
  $citeproc_json='{
        "id": "ITEM-17", 
        "title": "Beck v. Beck",
		"volume":1999,
        "container-title": "ME",
        "page": 110,
		"issued": {
           "date-parts": [
             [
                1999
             ]
           ]
		},
        "type": "legal_case"
    }';
  load_metadata_object_for_javascript($variable_name, $citeproc_json);
  
  $variable_name='ITEM-18';
  $citeproc_json='{
        "id": "ITEM-18", 
        "title": "Beck v. Beck",
		"volume":733,
        "container-title": "A.2d",
        "page": 981,
		"issued": {
           "date-parts": [
             [
                1999
             ]
           ]
		},
        "type": "legal_case"
    }';
  load_metadata_object_for_javascript($variable_name, $citeproc_json);
  
  $variable_name='ITEM-19';
  $citeproc_json='{
        "id": "ITEM-19", 
        "title": "Donoghue v. Stevenson",
		"volume":1932,
        "container-title": "App. Cas.",
        "page": 562,
		"issued": {
           "date-parts": [
             [
                1932
             ]
           ]
		},
        "type": "legal_case"
    }';
  load_metadata_object_for_javascript($variable_name, $citeproc_json);
  
  $variable_name='ITEM-20';
  $citeproc_json='{
        "id": "ITEM-20", 
        "title": "British Columbia Elec. Ry. v. Loach",
		"volume":1916,
		"issue":1,
        "container-title": "App. Cas.",
        "page": 719,
		"authority":"P.C.",
		"issued": {
           "date-parts": [
             [
                1915
             ]
           ]
		},
        "type": "legal_case"
    }';
  load_metadata_object_for_javascript($variable_name, $citeproc_json);
  
  
  
  //csl's
  $variable_name='chicago_author_date';
  $csl="<style       xmlns=\"http://purl.org/net/xbiblio/csl\"      class=\"in-text\"   default-locale=\"en-US-x-sort-ja-alalc97-x-sec-en\">  <!-- BOGUS COMMENT -->  <info>    <title>Chicago Manual of Style (Author-Date format)</title>    <id>http://www.zotero.org/styles/chicago-author-date</id>    <link href=\"http://www.zotero.org/styles/chicago-author-date\" />    <author>      <name>Julian Onions</name>      <email>julian.onions@gmail.com</email>    </author>    <category term=\"author-date\" />    <category term=\"generic-base\" />    <updated />    <summary>The author-date variant of the Chicago style</summary>    <link href=\"http://www.chicagomanualofstyle.org/tools_citationguide.html\" rel=\"documentation\" />  </info> <macro name=\"secondary-contributors\">    <choose>      <if match=\"none\" type=\"chapter\">        <group delimiter=\". \">          <choose>            <if variable=\"author\">              <names variable=\"editor\">                <label form=\"verb-short\" prefix=\" \" suffix=\". \" text-case=\"capitalize-first\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>          <choose>            <if match=\"any\" variable=\"author editor\">              <names variable=\"translator\">                <label form=\"verb-short\" prefix=\" \" suffix=\". \" text-case=\"capitalize-first\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>        </group>      </if>    </choose>  </macro>  <macro name=\"container-contributors\">    <choose>      <if type=\"chapter\">        <group delimiter=\", \" prefix=\",\">          <choose>            <if variable=\"author\">              <names variable=\"editor\">                <label form=\"verb-short\" prefix=\" \" suffix=\". \" text-case=\"lowercase\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>          <choose>            <if match=\"any\" variable=\"author editor\">              <names variable=\"translator\">                <label form=\"verb-short\" prefix=\" \" suffix=\". \" text-case=\"lowercase\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>        </group>      </if>    </choose>  </macro>  <macro name=\"anon\">    <choose>      <if match=\"none\" variable=\"author editor translator\">        <text form=\"short\" term=\"anonymous\" text-case=\"capitalize-first\" />      </if>    </choose>  </macro>  <macro name=\"editor\">    <names variable=\"editor\">      <name and=\"text\" delimiter=\", \" delimiter-precedes-last=\"always\" name-as-sort-order=\"first\" sort-separator=\", \" />      <label form=\"short\" prefix=\", \" suffix=\".\" />    </names>  </macro>  <macro name=\"translator\">    <names variable=\"translator\">      <name and=\"text\" delimiter=\", \" delimiter-precedes-last=\"always\" name-as-sort-order=\"first\" sort-separator=\", \" />      <label form=\"verb-short\" prefix=\", \" suffix=\".\" />    </names>  </macro>  <macro name=\"recipient\">    <choose>      <if type=\"personal_communication\">        <choose>          <if variable=\"genre\">            <text text-case=\"capitalize-first\" variable=\"genre\" />          </if>          <else>            <text term=\"letter\" text-case=\"capitalize-first\" />          </else>        </choose>      </if>    </choose>    <names delimiter=\", \" variable=\"recipient\">      <label form=\"verb\" prefix=\" \" suffix=\" \" text-case=\"lowercase\" />      <name and=\"text\" delimiter=\", \" />    </names>  </macro>  <macro name=\"contributors\">    <names variable=\"author\">      <name and=\"text\" delimiter=\", \" delimiter-precedes-last=\"always\" name-as-sort-order=\"first\" sort-separator=\", \" />      <label form=\"verb-short\" prefix=\", \" suffix=\".\" text-case=\"lowercase\" />      <substitute>        <text macro=\"editor\" />        <text macro=\"translator\" />      </substitute>    </names>    <text macro=\"anon\" />    <text macro=\"recipient\" />  </macro>  <macro name=\"contributors-short\">    <names variable=\"author\">      <name and=\"text\" delimiter=\", \" form=\"short\" />      <substitute>        <names variable=\"editor\" />        <names variable=\"translator\" />      </substitute>    </names>    <text macro=\"anon\" />  </macro>  <macro name=\"interviewer\">    <names delimiter=\", \" variable=\"interviewer\">      <label form=\"verb\" prefix=\" \" suffix=\" \" text-case=\"capitalize-first\" />      <name and=\"text\" delimiter=\", \" />    </names>  </macro>  <macro name=\"archive\">    <group delimiter=\". \">      <text text-case=\"capitalize-first\" variable=\"archive_location\" />      <text variable=\"archive\" />      <text variable=\"archive-place\" />    </group>  </macro>  <macro name=\"access\">    <group delimiter=\". \">      <choose>        <if match=\"any\" type=\"graphic report\">          <text macro=\"archive\" />        </if>        <else-if match=\"none\" type=\"book thesis chapter article-journal article-newspaper article-magazine\">          <text macro=\"archive\" />        </else-if>      </choose>      <text prefix=\"doi:\" variable=\"DOI\" />      <text variable=\"URL\" />    </group>  </macro>  <macro name=\"title\">    <choose>      <if match=\"none\" variable=\"title\">        <choose>          <if match=\"none\" type=\"personal_communication\">            <text text-case=\"capitalize-first\" variable=\"genre\" />          </if>        </choose>      </if>      <else-if type=\"book\">        <text font-style=\"italic\" variable=\"title\" />      </else-if>      <else>        <text variable=\"title\" />      </else>    </choose>  </macro>  <macro name=\"edition\">    <choose>      <if match=\"any\" type=\"book chapter\">        <choose>          <if is-numeric=\"edition\">            <group delimiter=\" \">              <number form=\"ordinal\" variable=\"edition\" />              <text form=\"short\" suffix=\".\" term=\"edition\" />            </group>          </if>          <else>            <text suffix=\".\" variable=\"edition\" />          </else>        </choose>      </if>    </choose>  </macro>  <macro name=\"locators\">    <choose>      <if type=\"article-journal\">        <text prefix=\" \" variable=\"volume\" />        <text prefix=\", no. \" variable=\"issue\" />      </if>      <else-if type=\"book\">        <group delimiter=\". \" prefix=\". \">          <group>            <text form=\"short\" suffix=\". \" term=\"volume\" text-case=\"capitalize-first\" />            <number form=\"numeric\" variable=\"volume\" />          </group>          <group>            <number form=\"numeric\" variable=\"number-of-volumes\" />            <text form=\"short\" plural=\"true\" prefix=\" \" suffix=\".\" term=\"volume\" />          </group>        </group>      </else-if>    </choose>  </macro>  <macro name=\"locators-chapter\">    <choose>      <if type=\"chapter\">        <group prefix=\", \">          <text suffix=\":\" variable=\"volume\" />          <text variable=\"page\" />        </group>      </if>    </choose>  </macro>  <macro name=\"locators-article\">    <choose>      <if type=\"article-newspaper\">        <group delimiter=\", \" prefix=\", \">          <group>            <text suffix=\" \" variable=\"edition\" />            <text prefix=\" \" term=\"edition\" />          </group>          <group>            <text form=\"short\" suffix=\". \" term=\"section\" />            <text variable=\"section\" />          </group>        </group>      </if>      <else-if type=\"article-journal\">        <text prefix=\": \" variable=\"page\" />      </else-if>    </choose>  </macro>  <macro name=\"point-locators\">    <group>      <choose>        <if locator=\"page\" match=\"none\">          <label form=\"short\" strip-periods=\"false\" suffix=\" \" variable=\"locator\" />        </if>      </choose>      <text variable=\"locator\" />    </group>  </macro>  <macro name=\"container-prefix\">    <text term=\"in\" text-case=\"capitalize-first\" />  </macro>  <macro name=\"container-title\">    <choose>      <if type=\"chapter\">        <text macro=\"container-prefix\" suffix=\" \" />      </if>    </choose>    <text font-style=\"italic\" variable=\"container-title\" form=\"short\"/>  </macro>  <macro name=\"publisher\">    <group delimiter=\": \">      <text variable=\"publisher-place\" />      <text variable=\"publisher\" />    </group>  </macro>  <macro name=\"date\">    <date variable=\"issued\" form=\"text\" date-parts=\"year\"><date-part name=\"year\"/></date>  </macro>  <macro name=\"day-month\">    <date variable=\"issued\">      <date-part name=\"month\" />      <date-part name=\"day\" prefix=\" \" />    </date>  </macro>  <macro name=\"collection-title\">    <text variable=\"collection-title\" />    <text prefix=\" \" variable=\"collection-number\" />  </macro>  <macro name=\"event\">    <group>      <text suffix=\" \" term=\"presented at\" />      <text variable=\"event\" />    </group>  </macro>  <macro name=\"description\">    <group delimiter=\". \">      <text macro=\"interviewer\" />      <text text-case=\"capitalize-first\" variable=\"medium\" />    </group>    <choose>      <if match=\"none\" variable=\"title\"> </if>      <else-if type=\"thesis\"> </else-if>      <else>        <text prefix=\". \" text-case=\"capitalize-first\" variable=\"genre\" />      </else>    </choose>  </macro>  <macro name=\"issue\">    <choose>      <if type=\"article-journal\">        <text macro=\"day-month\" prefix=\" (\" suffix=\")\" />      </if>      <else-if type=\"speech\">        <group delimiter=\", \" prefix=\" \">          <text macro=\"event\" />          <text macro=\"day-month\" />          <text variable=\"event-place\" />        </group>      </else-if>      <else-if match=\"any\" type=\"article-newspaper article-magazine\">        <text macro=\"day-month\" prefix=\", \" />      </else-if>      <else>        <group delimiter=\", \" prefix=\". \">          <choose>            <if type=\"thesis\">              <text text-case=\"capitalize-first\" variable=\"genre\" />            </if>          </choose>          <text macro=\"publisher\" />          <text macro=\"day-month\" />        </group>      </else>    </choose>  </macro>  <citation          disambiguate-add-givenname=\"true\"         disambiguate-add-names=\"true\"         disambiguate-add-year-suffix=\"true\"         et-al-min=\"4\"         et-al-subsequent-min=\"4\"         et-al-subsequent-use-first=\"1\"         et-al-use-first=\"1\">    <layout text-decoration=\"underline\" delimiter=\"; \" prefix=\"(\" suffix=\")\">      <group delimiter=\", \">        <group delimiter=\" \">          <text macro=\"contributors-short\" />          <text macro=\"date\" />        </group>        <text macro=\"point-locators\" />      </group>    </layout>  </citation>  <bibliography          entry-spacing=\"0\"         et-al-min=\"11\"         et-al-use-first=\"7\"         hanging-indent=\"true\"         subsequent-author-substitute=\"---\">    <sort>      <key macro=\"contributors\" />      <key variable=\"issued\" />    </sort>    <layout suffix=\".\">      <text macro=\"contributors\" suffix=\". \" />      <text macro=\"date\" suffix=\". \" />      <text macro=\"title\" />      <text macro=\"description\"/>      <text macro=\"secondary-contributors\" prefix=\". \" />      <text macro=\"container-title\" prefix=\". \"/>      <text macro=\"container-contributors\" />      <text macro=\"locators-chapter\" />      <text macro=\"edition\" prefix=\". \" />      <text macro=\"locators\" />      <text macro=\"collection-title\" prefix=\". \" />      <text macro=\"issue\" />      <text macro=\"locators-article\" />      <text macro=\"access\" prefix=\". \" />    </layout>  </bibliography></style>";
  load_csl_for_javascript($variable_name, $csl);
  
  $variable_name='bluebook_demo';
  $csl="<style       xmlns=\"http://purl.org/net/xbiblio/csl\"      class=\"note\"      version=\"1.0\"      page-range-format=\"chicago\"      default-locale=\"en-US-x-sort-ja-alalc97-x-sec-en-x-pri-ja-alalc97\">  <info>    <title>Bluebook (demo)</title>    <id>http://www.zotero.org/styles/bluebook-demo</id>    <link rel=\"self\" href=\"http://www.zotero.org/styles/bluebook-demo\" />    <link href=\"http://www.legalbluebook.com/\" rel=\"documentation\" />    <author>      <name>Frank Bennett</name>      <email>biercenator@gmail.com</email>    </author>    <summary>Bluebook Style for legal materials</summary>    <category field=\"generic-base\" />    <category citation-format=\"numeric\" />    <updated>2010-04-24T04:49:00+09:00</updated>  </info>  <locale>	<terms>	  <term name=\"ibid\">id.</term>      <term name=\"rule\"></term>	</terms>  </locale>  <!-- ### CHICAGO FULLNOTE WITH BIBLIOGRAPHY (mainstream) ### -->  <macro name=\"editor-translator\">    <group delimiter=\", \">      <choose>        <if variable=\"author\">          <names delimiter=\", \" variable=\"editor\">            <label form=\"verb-short\" suffix=\". \" text-case=\"lowercase\" />            <name and=\"text\" delimiter=\", \" />          </names>        </if>      </choose>      <choose>        <if match=\"any\" variable=\"author editor\">          <names delimiter=\", \" variable=\"translator\">            <label form=\"verb-short\" suffix=\". \" text-case=\"lowercase\" />            <name and=\"text\" delimiter=\", \" />          </names>        </if>      </choose>    </group>  </macro>  <macro name=\"secondary-contributors-note\">    <choose>      <if match=\"none\" type=\"chapter\">        <text macro=\"editor-translator\" />      </if>    </choose>  </macro>  <macro name=\"container-contributors-note\">    <choose>      <if type=\"chapter\">        <text macro=\"editor-translator\" />      </if>    </choose>  </macro>  <macro name=\"secondary-contributors\">    <choose>      <if match=\"none\" type=\"chapter\">        <group delimiter=\". \">          <choose>            <if variable=\"author\">              <names delimiter=\". \" variable=\"editor\">                <label form=\"verb\" prefix=\" \" suffix=\" \" text-case=\"capitalize-first\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>          <choose>            <if match=\"any\" variable=\"author editor\">              <names delimiter=\". \" variable=\"translator\">                <label form=\"verb\" prefix=\" \" suffix=\" \" text-case=\"capitalize-first\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>        </group>      </if>    </choose>  </macro>  <macro name=\"container-contributors\">    <choose>      <if type=\"chapter\">        <group delimiter=\", \">          <choose>            <if variable=\"author\">              <names delimiter=\", \" variable=\"editor\">                <label form=\"verb\" suffix=\" \" text-case=\"lowercase\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>          <choose>            <if match=\"any\" variable=\"author editor\">              <names delimiter=\", \" variable=\"translator\">                <label form=\"verb\" suffix=\" \" text-case=\"lowercase\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>        </group>      </if>    </choose>  </macro>  <macro name=\"editor-note\">    <names variable=\"editor\">      <name and=\"text\" delimiter=\", \" sort-separator=\", \" />      <label form=\"short\" prefix=\", \" suffix=\".\" />    </names>  </macro>  <macro name=\"translator-note\">    <names variable=\"translator\">      <name and=\"text\" delimiter=\", \" sort-separator=\", \" />      <label form=\"verb-short\" prefix=\", \" suffix=\".\" />    </names>  </macro>  <macro name=\"recipient-note\">    <names delimiter=\", \" variable=\"recipient\">      <label form=\"verb\" prefix=\" \" suffix=\" \" text-case=\"lowercase\" />      <name and=\"text\" delimiter=\", \" />    </names>  </macro>  <macro name=\"contributors-note\">    <names variable=\"author\">      <name and=\"text\" delimiter=\", \" sort-separator=\", \" />      <substitute>        <text macro=\"editor-note\" />        <text macro=\"translator-note\" />      </substitute>    </names>    <text macro=\"recipient-note\" />  </macro>  <macro name=\"editor\">    <names variable=\"editor\">      <name and=\"text\" delimiter=\", \" delimiter-precedes-last=\"always\" name-as-sort-order=\"first\" sort-separator=\", \" />      <label form=\"short\" prefix=\", \" suffix=\".\" />    </names>  </macro>  <macro name=\"translator\">    <names variable=\"translator\">      <name and=\"text\" delimiter=\", \" delimiter-precedes-last=\"always\" name-as-sort-order=\"first\" sort-separator=\", \" />      <label form=\"verb-short\" prefix=\", \" suffix=\".\" />    </names>  </macro>  <macro name=\"recipient\">    <choose>      <if type=\"personal_communication\">        <choose>          <if variable=\"genre\">            <text text-case=\"capitalize-first\" variable=\"genre\" />          </if>          <else>            <text term=\"letter\" text-case=\"capitalize-first\" />          </else>        </choose>      </if>    </choose>    <text macro=\"recipient-note\" prefix=\" \" />  </macro>  <macro name=\"contributors\">    <names variable=\"author\">      <name and=\"text\" delimiter=\", \" delimiter-precedes-last=\"always\" name-as-sort-order=\"first\" sort-separator=\", \" />      <substitute>        <text macro=\"editor\" />        <text macro=\"translator\" />      </substitute>    </names>    <text macro=\"recipient\" prefix=\". \" />  </macro>  <macro name=\"recipient-short\">    <names variable=\"recipient\">      <label form=\"verb\" prefix=\" \" suffix=\" \" text-case=\"lowercase\" />      <name and=\"text\" delimiter=\", \" form=\"short\" />    </names>  </macro>  <macro name=\"contributors-short\">    <names variable=\"author\">      <name and=\"text\" delimiter=\", \" form=\"short\" />      <substitute>        <names variable=\"editor\" />        <names variable=\"translator\" />      </substitute>    </names>    <text macro=\"recipient-short\" />  </macro>  <macro name=\"contributors-sort\">    <names variable=\"author\">      <name and=\"text\" delimiter=\", \" delimiter-precedes-last=\"always\" name-as-sort-order=\"all\" sort-separator=\", \" />      <label form=\"verb-short\" prefix=\", \" suffix=\".\" />      <substitute>        <names variable=\"editor\" />        <names variable=\"translator\" />      </substitute>    </names>  </macro>  <macro name=\"interviewer-note\">    <names delimiter=\", \" variable=\"interviewer\">      <label form=\"verb\" prefix=\" \" suffix=\" \" text-case=\"lowercase\" />      <name and=\"text\" delimiter=\", \" />    </names>  </macro>  <macro name=\"interviewer\">    <names delimiter=\", \" variable=\"interviewer\">      <label form=\"verb\" prefix=\" \" suffix=\" \" text-case=\"capitalize-first\" />      <name and=\"text\" delimiter=\", \" />    </names>  </macro>  <macro name=\"title-note\">    <choose>      <if match=\"none\" variable=\"title\">        <text variable=\"genre\" />      </if>      <else-if type=\"book\">        <text font-style=\"italic\" variable=\"title\" />      </else-if>      <else>        <text quotes=\"true\" variable=\"title\" />      </else>    </choose>  </macro>  <macro name=\"title\">    <choose>      <if match=\"none\" variable=\"title\">        <choose>          <if match=\"none\" type=\"personal_communication\">            <text text-case=\"capitalize-first\" variable=\"genre\" />          </if>        </choose>      </if>      <else-if type=\"book\">        <text font-style=\"italic\" variable=\"title\" />      </else-if>      <else>        <text quotes=\"true\" variable=\"title\" />      </else>    </choose>  </macro>  <macro name=\"title-short\">    <choose>      <if match=\"none\" variable=\"title\">        <choose>          <if type=\"interview\">            <text term=\"interview\" text-case=\"lowercase\" />          </if>          <else-if match=\"any\" type=\"manuscript speech\">            <text form=\"short\" variable=\"genre\" />          </else-if>          <else-if type=\"personal_communication\">            <text macro=\"issued\" />          </else-if>        </choose>      </if>      <else-if type=\"book\">        <text font-style=\"italic\" form=\"short\" variable=\"title\" />      </else-if>      <else>        <text form=\"short\" quotes=\"true\" variable=\"title\" />      </else>    </choose>  </macro>  <macro name=\"description-note\">    <group delimiter=\", \">      <text macro=\"interviewer-note\" />      <text variable=\"medium\" />      <choose>        <if match=\"none\" variable=\"title\"> </if>        <else-if match=\"any\" type=\"thesis speech\"> </else-if>        <else>          <text variable=\"genre\" />        </else>      </choose>    </group>  </macro>  <macro name=\"description\">    <group delimiter=\", \">      <group delimiter=\". \">        <text macro=\"interviewer\" />        <text text-case=\"capitalize-first\" variable=\"medium\" />      </group>      <choose>        <if match=\"none\" variable=\"title\"> </if>        <else-if match=\"any\" type=\"thesis speech\"> </else-if>        <else>          <text text-case=\"capitalize-first\" variable=\"genre\" />        </else>      </choose>    </group>  </macro>  <macro name=\"container-title-note\">    <choose>      <if type=\"chapter\">        <text suffix=\" \" term=\"in\" text-case=\"lowercase\" />      </if>    </choose>    <text font-style=\"italic\" variable=\"container-title\" />  </macro>  <macro name=\"container-title\">    <choose>      <if type=\"chapter\">        <text suffix=\" \" term=\"in\" text-case=\"capitalize-first\" />      </if>    </choose>    <text font-style=\"italic\" variable=\"container-title\" />  </macro>  <macro name=\"collection-title\">    <text variable=\"collection-title\" />    <text prefix=\" \" variable=\"collection-number\" />  </macro>  <macro name=\"edition-note\">    <choose>      <if match=\"any\" type=\"book chapter\">        <choose>          <if is-numeric=\"edition\">            <group delimiter=\" \">              <number form=\"ordinal\" variable=\"edition\" />              <text form=\"short\" suffix=\".\" term=\"edition\" />            </group>          </if>          <else>            <text suffix=\".\" variable=\"edition\" />          </else>        </choose>      </if>    </choose>  </macro>  <macro name=\"edition\">    <choose>      <if match=\"any\" type=\"book chapter\">        <choose>          <if is-numeric=\"edition\">            <group delimiter=\" \">              <number form=\"ordinal\" variable=\"edition\" />              <text form=\"short\" suffix=\".\" term=\"edition\" />            </group>          </if>          <else>            <text suffix=\".\" text-case=\"capitalize-first\" variable=\"edition\" />          </else>        </choose>      </if>    </choose>  </macro>  <macro name=\"locators-note\">    <choose>      <if type=\"article-journal\">        <text prefix=\" \" variable=\"volume\" />        <text prefix=\", no. \" variable=\"issue\" />      </if>      <else-if match=\"any\" type=\"book chapter\">        <group delimiter=\", \" prefix=\", \">          <group>            <text form=\"short\" suffix=\". \" term=\"volume\" />            <number form=\"numeric\" variable=\"volume\" />          </group>          <choose>            <if match=\"none\" variable=\"locator\">              <group>                <number form=\"numeric\" variable=\"number-of-volumes\" />                <text form=\"short\" plural=\"true\" prefix=\" \" suffix=\".\" term=\"volume\" />              </group>            </if>          </choose>          <text macro=\"edition-note\" />        </group>      </else-if>    </choose>  </macro>  <macro name=\"locators\">    <choose>      <if type=\"article-journal\">        <text prefix=\" \" variable=\"volume\" />        <text prefix=\", no. \" variable=\"issue\" />      </if>      <else-if match=\"any\" type=\"book\">        <group delimiter=\". \" prefix=\". \">          <group>            <text form=\"short\" suffix=\". \" term=\"volume\" text-case=\"capitalize-first\" />            <number form=\"numeric\" variable=\"volume\" />          </group>          <group>            <number form=\"numeric\" variable=\"number-of-volumes\" />            <text form=\"short\" plural=\"true\" prefix=\" \" suffix=\".\" term=\"volume\" />          </group>          <text macro=\"edition\" />        </group>      </else-if>    </choose>  </macro>  <macro name=\"locators-newspaper\">    <choose>      <if type=\"article-newspaper\">        <group delimiter=\", \">          <group>            <text suffix=\" \" variable=\"edition\" />            <text prefix=\" \" term=\"edition\" />          </group>          <group>            <text form=\"short\" suffix=\". \" term=\"section\" />            <text variable=\"section\" />          </group>        </group>      </if>    </choose>  </macro>  <macro name=\"event\">    <group>      <text suffix=\" \" term=\"presented at\" />      <text variable=\"event\" />    </group>  </macro>  <macro name=\"publisher\">    <group delimiter=\": \">      <text variable=\"publisher-place\" />      <text variable=\"publisher\" />    </group>  </macro>  <macro name=\"issued\">    <choose>      <if match=\"any\" type=\"graphic report\">        <date variable=\"issued\">          <date-part name=\"month\" suffix=\" \" />          <date-part name=\"day\" suffix=\", \" />          <date-part name=\"year\" />        </date>      </if>      <else-if match=\"any\" type=\"book chapter thesis\">        <date variable=\"issued\">          <date-part name=\"year\" />        </date>      </else-if>      <else>        <date variable=\"issued\">          <date-part name=\"month\" suffix=\" \" />          <date-part name=\"day\" suffix=\", \" />          <date-part name=\"year\" />        </date>      </else>    </choose>  </macro>  <macro name=\"point-locators-subsequent\">    <group>      <choose>        <if locator=\"page\" match=\"none\">          <label form=\"short\" strip-periods=\"false\" suffix=\" \" variable=\"locator\" />        </if>      </choose>      <text variable=\"locator\" />    </group>  </macro>  <macro name=\"point-locators\">    <choose>      <if match=\"none\" variable=\"locator\">        <text macro=\"pages\" />      </if>      <else-if type=\"article-journal\">        <text prefix=\": \" variable=\"locator\" />      </else-if>      <else>        <text macro=\"point-locators-subsequent\" prefix=\", \" />      </else>    </choose>  </macro>  <macro name=\"pages\">    <choose>      <if type=\"article-journal\">        <text prefix=\": \" variable=\"page\" />      </if>      <else-if type=\"chapter\">        <text prefix=\", \" variable=\"page\" />      </else-if>    </choose>  </macro>  <macro name=\"locators-chapter\">    <choose>      <if type=\"chapter\">        <text suffix=\":\" variable=\"volume\" />        <text variable=\"page\" />      </if>    </choose>  </macro>  <macro name=\"locators-journal\">    <choose>      <if type=\"article-journal\">        <text prefix=\": \" variable=\"page\" />      </if>    </choose>  </macro>  <macro name=\"archive-note\">    <group delimiter=\", \">      <text variable=\"archive_location\" />      <text variable=\"archive\" />      <text variable=\"archive-place\" />    </group>  </macro>  <macro name=\"archive\">    <group delimiter=\". \">      <text text-case=\"capitalize-first\" variable=\"archive_location\" />      <text variable=\"archive\" />      <text variable=\"archive-place\" />    </group>  </macro>  <macro name=\"issue-note\">    <choose>      <if type=\"article-journal\">        <text macro=\"issued\" prefix=\" (\" suffix=\")\" />      </if>      <else-if match=\"any\" variable=\"publisher-place publisher\">        <group delimiter=\", \" prefix=\" (\" suffix=\")\">          <group delimiter=\" \">            <choose>              <if match=\"none\" variable=\"title\"> </if>              <else-if match=\"any\" type=\"thesis speech\">                <text variable=\"genre\" />              </else-if>            </choose>            <text macro=\"event\" />          </group>          <text macro=\"publisher\" />          <text macro=\"issued\" />        </group>      </else-if>      <else>        <text macro=\"issued\" prefix=\", \" />      </else>    </choose>  </macro>  <macro name=\"issue\">    <choose>      <if type=\"article-journal\">        <text macro=\"issued\" prefix=\" (\" suffix=\")\" />      </if>      <else-if type=\"speech\">        <choose>          <if match=\"none\" variable=\"title\"> </if>          <else>            <text prefix=\". \" text-case=\"capitalize-first\" variable=\"genre\" />          </else>        </choose>        <text macro=\"event\" prefix=\" \" />        <text prefix=\", \" variable=\"event-place\" />        <text macro=\"issued\" prefix=\", \" />      </else-if>      <else-if match=\"any\" variable=\"publisher-place publisher\">        <group delimiter=\", \" prefix=\". \">          <choose>            <if type=\"thesis\">              <text text-case=\"capitalize-first\" variable=\"genre\" />            </if>          </choose>          <text macro=\"publisher\" />          <text macro=\"issued\" />        </group>      </else-if>      <else>        <text macro=\"issued\" prefix=\", \" />      </else>    </choose>  </macro>  <macro name=\"access-note\">    <group delimiter=\", \">      <choose>        <if match=\"any\" type=\"graphic report\">          <text macro=\"archive-note\" />        </if>        <else-if match=\"none\" type=\"book thesis chapter article-journal article-newspaper article-magazine\">          <text macro=\"archive-note\" />        </else-if>      </choose>      <text prefix=\"doi:\" variable=\"DOI\" />      <text variable=\"URL\" />    </group>  </macro>  <macro name=\"access\">    <group delimiter=\". \">      <choose>        <if match=\"any\" type=\"graphic report\">          <text macro=\"archive\" />        </if>        <else-if match=\"none\" type=\"book thesis chapter article-journal article-newspaper article-magazine\">          <text macro=\"archive\" />        </else-if>      </choose>      <text variable=\"URL\" />    </group>  </macro>  <macro name=\"sort-key\">    <text macro=\"contributors-sort\" suffix=\" \" />    <text suffix=\" \" variable=\"title\" />    <text variable=\"genre\" />  </macro>  <!-- ### BLUEBOOK AUTHOR ### -->  <macro name=\"bb-author\">	<names variable=\"author\">	  <name/>	</names>  </macro>  <macro name=\"bb-author-short\">	<names variable=\"author\">	  <name form=\"short\"/>	</names>  </macro>  <!-- ### BLUEBOOK ISSUED ### -->  <macro name=\"bb-issued\">	<group prefix=\"(\" suffix=\")\">	  <date variable=\"issued\" form=\"text\" date-parts=\"year\"/>	</group>  </macro>  <!-- ### ID BACKREFERENCES ### -->  <macro name=\"bb-ibid\">	<choose> 	  <if position=\"ibid-with-locator\">		<text term=\"ibid\" font-style=\"italic\"/>		<group delimiter=\" \">		  <choose>			<if locator=\"page\">			  <text value=\" at\"/>			</if>			<else>			  <text value=\", \"/>			  <label form=\"short\" variable=\"locator\"/>			</else>		  </choose>		  <text variable=\"locator\"/>		</group>	  </if>	  <else-if position=\"ibid\">		<text term=\"ibid\" font-style=\"italic\"/>	  </else-if>	</choose>  </macro>  <!-- ### POINT LOCATORS -->  <macro name=\"bb-point-locator\">	<group delimiter=\" \">	  <choose>		<if variable=\"number page\" position=\"ibid\" match=\"any\">		  <text value=\",\"/>		</if>	  </choose>	  <choose>		<if locator=\"page\" match=\"none\">		  <label form=\"symbol\" variable=\"locator\"/>		</if>	  </choose>	  <text variable=\"locator\"/>	</group>  </macro>  <macro name=\"bb-point-locator-subsequent\">	<group delimiter=\" \">	  <choose>		<if locator=\"page\" match=\"none\">		  <label form=\"symbol\" variable=\"locator\"/>		</if>	  </choose>	  <text variable=\"locator\"/>	</group>  </macro>  <!-- ### LEGAL CASE ### -->  <macro name=\"bb-legal-case\">	<choose>	  <if position=\"first\">		<text macro=\"bb-legal-case-first\"/>	  </if>	  <else-if position=\"ibid\">		<text macro=\"bb-ibid\"/>	  </else-if>	  <else-if position=\"subsequent\">		<text macro=\"bb-legal-case-subsequent\"/>	  </else-if>	  <else>		<text macro=\"bb-legal-case-first\"/>	  </else>	</choose>  </macro>  <macro name=\"bb-legal-case-first\">    <group delimiter=\", \">      <text variable=\"title\"/>      <group delimiter=\" \">		<choose>		  <if variable=\"issue\">			<text variable=\"volume\" prefix=\"[\" suffix=\"]\"/>			<text variable=\"issue\"/>		  </if>		  <else>			<text variable=\"volume\"/>		  </else>		</choose>        <text variable=\"container-title\"/>		<group>		  <text variable=\"page\"/>		  <text macro=\"bb-point-locator\"/>		</group>        <group prefix=\"(\" suffix=\")\" delimiter=\" \">          <text variable=\"authority\" form=\"short\"/>          <date variable=\"issued\">            <date-part name=\"year\"/>	          </date>        </group>	      </group>	</group>  </macro>  <macro name=\"bb-legal-case-subsequent\">    <group delimiter=\", \">      <text variable=\"title\"/>      <group delimiter=\" \">		<choose>		  <if variable=\"issue\">			<text variable=\"volume\" prefix=\"[\" suffix=\"]\"/>			<text variable=\"issue\"/>		  </if>		  <else>			<text variable=\"volume\"/>		  </else>		</choose>        <text variable=\"container-title\"/>		<group>		  <text macro=\"bb-point-locator-subsequent\"/>		</group>      </group>	</group>  </macro>  <!-- ### LEGISLATION ### -->  <macro name=\"bb-legislation\">	<choose>	  <if position=\"first\">		<text macro=\"bb-legislation-first\"/>	  </if>	  <else-if position=\"near-note\">		<text macro=\"bb-legislation-subsequent\"/>	  </else-if>	  <else>		<text macro=\"bb-legislation-first\"/>	  </else>	</choose>  </macro>  <macro name=\"bb-legislation-first\">	<choose>	  <if variable=\"container-title\">		<text macro=\"bb-statute-first\"/>	  </if>	  <else>		<text macro=\"bb-code-first\"/>	  </else>	</choose>  </macro>  <macro name=\"bb-legislation-subsequent\">	<choose>	  <if variable=\"container-title\">		<text macro=\"bb-statute-subsequent\"/>	  </if>	  <else>		<text macro=\"bb-code-subsequent\"/>	  </else>	</choose>  </macro>  <macro name=\"bb-statute-first\">	<group delimiter=\", \">	  <text variable=\"title\"/>	  <text macro=\"bb-statute-subsequent\"/>	</group>  </macro>  <macro name=\"bb-statute-subsequent\">	<group delimiter=\"\">	  <group delimiter=\" \">		<text variable=\"volume\"/>		<text variable=\"container-title\"/>		<text variable=\"number\"/>		<text variable=\"page\"/>		<choose>		  <if is-numeric=\"section\">			<text term=\"section\" form=\"symbol\"/>			<text variable=\"section\"/>		  </if>		</choose>	  </group>	  <text macro=\"bb-point-locator\"/>	  <date prefix=\" (\" variable=\"issued\" date-parts=\"year\" form=\"text\" suffix=\")\"/>	</group>  </macro>  <macro name=\"bb-code-first\">	<group delimiter=\" \">	  <text variable=\"title\" font-variant=\"small-caps\"/>	  <group delimiter=\" \">		<label variable=\"locator\" form=\"symbol\"/>		<text variable=\"locator\"/>	  </group>	</group>  </macro>  <macro name=\"bb-code-subsequent\">	<group delimiter=\" \">	  <text variable=\"title\" form=\"short\" font-variant=\"small-caps\"/>	  <group delimiter=\" \">		<label variable=\"locator\" form=\"symbol\"/>		<text variable=\"locator\"/>	  </group>	</group>  </macro>  <!-- ### BOOK ### -->  <macro name=\"bb-book\">	<choose>	  <if position=\"first\">		<text macro=\"bb-book-first\"/>	  </if>	  <else-if position=\"ibid\">		<text macro=\"bb-ibid\"/>	  </else-if>	  <else-if position=\"subsequent\">		<text macro=\"bb-book-subsequent\"/>	  </else-if>	</choose>  </macro>  <macro name=\"bb-book-first\">	<group delimiter=\", \">	  <text macro=\"bb-author\" font-variant=\"small-caps\"/>	  <group delimiter=\" \">		<text variable=\"title\" font-variant=\"small-caps\"/>		<group delimiter=\" \">		  <choose>			<if locator=\"page\" match=\"none\">			  <label variable=\"locator\" form=\"symbol\"/>			</if>		  </choose>		  <text variable=\"locator\"/>		</group>		<text macro=\"bb-issued\"/>	  </group>	</group>  </macro>  <macro name=\"bb-book-subsequent\">    <group delimiter=\", \">	  <text macro=\"bb-author-short\" font-variant=\"small-caps\"/>	  <choose>		<if disambiguate=\"true\">		  <text variable=\"title\" font-variant=\"small-caps\"/>		</if>	  </choose>	  <group delimiter=\"\">		<group delimiter=\" \">		  <text value=\"supra\" font-style=\"italic\"/>		  <choose>			<if variable=\"first-reference-note-number\">			  <text value=\"note\"/>			  <text variable=\"first-reference-note-number\"/>			</if>		  </choose>		</group>		<group delimiter=\" \">		  <choose>			<if locator=\"page\">			  <text value=\",\"/>			  <text value=\"at\"/>			</if>			<else>			  <label variable=\"locator\"/>			</else>		  </choose>		  <text variable=\"locator\"/>		</group>	  </group>	</group>  </macro>  <!-- ### PERIODICAL ### -->  <macro name=\"bb-periodical\">	<choose>	  <if position=\"first\">		<text macro=\"bb-periodical-first\"/>	  </if>	  <else-if position=\"ibid\">		<text term=\"ibid\" font-style=\"italic\"/>	  </else-if>	  <else-if position=\"subsequent\">		<text macro=\"bb-periodical-subsequent\"/>	  </else-if>	</choose>  </macro>  <macro name=\"bb-periodical-first\">	<group delimiter=\" \">	  <group delimiter=\", \">		<names variable=\"author\">		  <name/>		</names>		<text variable=\"title\" font-style=\"italic\"/>		<group delimiter=\" \">		  <text variable=\"volume\"/>		  <text variable=\"container-title\" form=\"short\" font-variant=\"small-caps\"/>		  <text variable=\"page-first\"/>		</group>	  </group>	  <text macro=\"bb-issued\"/>	</group>  </macro>  <macro name=\"bb-periodical-subsequent\">	<text value=\"bb-periodical-subsequent\"/>  </macro>  <!-- ### CITATIONS ARE BLUEBOOK (demo version) ### -->  <citation         near-note-distance=\"5\"         et-al-min=\"2\"         et-al-subsequent-min=\"4\"         et-al-subsequent-use-first=\"2\"         et-al-use-first=\"1\">    <layout delimiter=\"; \" suffix=\".\">      <choose>        <if type=\"legal_case\">          <text macro=\"bb-legal-case\"/>        </if>		<else-if type=\"legislation\">		  <text macro=\"bb-legislation\"/>		</else-if>		<else-if type=\"book\">		  <text macro=\"bb-book\"/>		</else-if>        <else>		  <text macro=\"bb-periodical\"/>		</else>	  </choose>    </layout>  </citation>  <!-- BIBLIOGRAPHY IS CHICAGO FULLNOTE (mainstream) ### -->  <bibliography          entry-spacing=\"0\"         et-al-min=\"11\"         et-al-use-first=\"7\"         hanging-indent=\"true\"         subsequent-author-substitute=\"---\">    <sort>      <key macro=\"sort-key\" />      <key variable=\"issued\" />    </sort>    <layout suffix=\".\">		  <choose>			<if type=\"legal_case\">		  <text macro=\"bb-legal-case\"/>		</if>		<else-if type=\"legislation\">		  <text macro=\"bb-legislation\"/>		</else-if>		<else>		  <group delimiter=\". \">			<text macro=\"contributors\" />			<text macro=\"title\" />			<text macro=\"description\" />			<text macro=\"secondary-contributors\" />			<group delimiter=\", \">			  <text macro=\"container-title\" />			  <text macro=\"container-contributors\" />			  <text macro=\"locators-chapter\" />			</group>		  </group>		  <text macro=\"locators\" />		  <text macro=\"collection-title\" prefix=\". \" />		  <text macro=\"issue\" />		  <text macro=\"locators-newspaper\" prefix=\", \" />		  <text macro=\"locators-journal\" />		  <text macro=\"access\" prefix=\". \" />			</else>		  </choose>	</layout>  </bibliography></style>";
  load_csl_for_javascript($variable_name, $csl);
  
  $variable_name='chicago_fullnote_bibliography2';
  $csl="<style       xmlns=\"http://purl.org/net/xbiblio/csl\"      class=\"note\"   page-range-format=\"chicago\" default-locale=\"en-US-x-sort-ja-alalc97-x-sec-en-x-pri-ja-alalc97\">  <info>    <title>Chicago Manual of Style (Full Note with Bibliography)</title>    <id>http://www.zotero.org/styles/chicago-fullnote-bibliography</id>    <link href=\"http://www.zotero.org/styles/chicago-fullnote-bibliography\" />    <link href=\"http://www.chicagomanualofstyle.org/tools_citationguide.html\" rel=\"documentation\" />    <author>      <name>Julian Onions</name>      <email>julian.onions@gmail.com</email>    </author>    <contributor>      <name>Simon Kornblith</name>      <email>simon@simonster.com</email>    </contributor>    <contributor>      <name>Elena Razlogova</name>      <email>elena.razlogova@gmail.com</email>    </contributor>    <summary>Chicago format with full notes and bibliography</summary>    <category term=\"generic-base\" />    <category term=\"numeric\" />    <updated />  </info>  <locale>	<style-options punctuation-in-quote=\"false\"/></locale><macro name=\"editor-translator\">    <group delimiter=\", \">      <choose>        <if variable=\"author\">          <names delimiter=\", \" variable=\"editor\">            <label form=\"verb-short\" suffix=\". \" text-case=\"lowercase\" />            <name and=\"text\" delimiter=\", \" />          </names>        </if>      </choose>      <choose>        <if match=\"any\" variable=\"author editor\">          <names delimiter=\", \" variable=\"translator\">            <label form=\"verb-short\" suffix=\". \" text-case=\"lowercase\" />            <name and=\"text\" delimiter=\", \" />          </names>        </if>      </choose>    </group>  </macro>  <macro name=\"secondary-contributors-note\">    <choose>      <if match=\"none\" type=\"chapter\">        <text macro=\"editor-translator\" />      </if>    </choose>  </macro>  <macro name=\"container-contributors-note\">    <choose>      <if type=\"chapter\">        <text macro=\"editor-translator\" />      </if>    </choose>  </macro>  <macro name=\"secondary-contributors\">    <choose>      <if match=\"none\" type=\"chapter\">        <group delimiter=\". \">          <choose>            <if variable=\"author\">              <names delimiter=\". \" variable=\"editor\">                <label form=\"verb\" prefix=\" \" suffix=\" \" text-case=\"capitalize-first\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>          <choose>            <if match=\"any\" variable=\"author editor\">              <names delimiter=\". \" variable=\"translator\">                <label form=\"verb\" prefix=\" \" suffix=\" \" text-case=\"capitalize-first\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>        </group>      </if>    </choose>  </macro>  <macro name=\"container-contributors\">    <choose>      <if type=\"chapter\">        <group delimiter=\", \">          <choose>            <if variable=\"author\">              <names delimiter=\", \" variable=\"editor\">                <label form=\"verb\" suffix=\" \" text-case=\"lowercase\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>          <choose>            <if match=\"any\" variable=\"author editor\">              <names delimiter=\", \" variable=\"translator\">                <label form=\"verb\" suffix=\" \" text-case=\"lowercase\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>        </group>      </if>    </choose>  </macro>  <macro name=\"editor-note\">    <names variable=\"editor\">      <name and=\"text\" delimiter=\", \" sort-separator=\", \" />      <label form=\"short\" prefix=\", \" suffix=\".\" />    </names>  </macro>  <macro name=\"translator-note\">    <names variable=\"translator\">      <name and=\"text\" delimiter=\", \" sort-separator=\", \" />      <label form=\"verb-short\" prefix=\", \" suffix=\".\" />    </names>  </macro>  <macro name=\"recipient-note\">    <names delimiter=\", \" variable=\"recipient\">      <label form=\"verb\" prefix=\" \" suffix=\" \" text-case=\"lowercase\" />      <name and=\"text\" delimiter=\", \" />    </names>  </macro>  <macro name=\"contributors-note\">    <names variable=\"author\">      <name and=\"text\" delimiter=\", \" sort-separator=\", \" />      <substitute>        <text macro=\"editor-note\" />        <text macro=\"translator-note\" />      </substitute>    </names>    <text macro=\"recipient-note\" />  </macro>  <macro name=\"editor\">    <names variable=\"editor\">      <name and=\"text\" delimiter=\", \" delimiter-precedes-last=\"always\" name-as-sort-order=\"first\" sort-separator=\", \" />      <label form=\"short\" prefix=\", \" suffix=\".\" />    </names>  </macro>  <macro name=\"translator\">    <names variable=\"translator\">      <name and=\"text\" delimiter=\", \" delimiter-precedes-last=\"always\" name-as-sort-order=\"first\" sort-separator=\", \" />      <label form=\"verb-short\" prefix=\", \" suffix=\".\" />    </names>  </macro>  <macro name=\"recipient\">    <choose>      <if type=\"personal_communication\">        <choose>          <if variable=\"genre\">            <text text-case=\"capitalize-first\" variable=\"genre\" />          </if>          <else>            <text term=\"letter\" text-case=\"capitalize-first\" />          </else>        </choose>      </if>    </choose>    <text macro=\"recipient-note\" prefix=\" \" />  </macro>  <macro name=\"contributors\">    <names variable=\"author\">      <name and=\"text\" delimiter=\", \" delimiter-precedes-last=\"always\" name-as-sort-order=\"first\" sort-separator=\", \" />      <substitute>        <text macro=\"editor\" />        <text macro=\"translator\" />      </substitute>    </names>    <text macro=\"recipient\" prefix=\". \" />  </macro>  <macro name=\"recipient-short\">    <names variable=\"recipient\">      <label form=\"verb\" prefix=\" \" suffix=\" \" text-case=\"lowercase\" />      <name and=\"text\" delimiter=\", \" form=\"short\" />    </names>  </macro>  <macro name=\"contributors-short\">    <names variable=\"author\">      <name and=\"text\" delimiter=\", \" form=\"short\" />      <substitute>        <names variable=\"editor\" />        <names variable=\"translator\" />      </substitute>    </names>    <text macro=\"recipient-short\" />  </macro>  <macro name=\"contributors-sort\">    <names variable=\"author\">      <name and=\"text\" delimiter=\", \" delimiter-precedes-last=\"always\" name-as-sort-order=\"all\" sort-separator=\", \" />      <label form=\"verb-short\" prefix=\", \" suffix=\".\" />      <substitute>        <names variable=\"editor\" />        <names variable=\"translator\" />      </substitute>    </names>  </macro>  <macro name=\"interviewer-note\">    <names delimiter=\", \" variable=\"interviewer\">      <label form=\"verb\" prefix=\" \" suffix=\" \" text-case=\"lowercase\" />      <name and=\"text\" delimiter=\", \" />    </names>  </macro>  <macro name=\"interviewer\">    <names delimiter=\", \" variable=\"interviewer\">      <label form=\"verb\" prefix=\" \" suffix=\" \" text-case=\"capitalize-first\" />      <name and=\"text\" delimiter=\", \" />    </names>  </macro>  <macro name=\"title-note\">    <choose>      <if match=\"none\" variable=\"title\">        <text variable=\"genre\" />      </if>      <else-if type=\"book\">        <text font-style=\"italic\" variable=\"title\" />      </else-if>      <else>        <text quotes=\"true\" variable=\"title\" />      </else>    </choose>  </macro>  <macro name=\"title\">    <choose>      <if match=\"none\" variable=\"title\">        <choose>          <if match=\"none\" type=\"personal_communication\">            <text text-case=\"capitalize-first\" variable=\"genre\" />          </if>        </choose>      </if>      <else-if type=\"book\">        <text font-style=\"italic\" variable=\"title\" />      </else-if>      <else>        <text quotes=\"true\" variable=\"title\" />      </else>    </choose>  </macro>  <macro name=\"title-short\">    <choose>      <if match=\"none\" variable=\"title\">        <choose>          <if type=\"interview\">            <text term=\"interview\" text-case=\"lowercase\" />          </if>          <else-if match=\"any\" type=\"manuscript speech\">            <text form=\"short\" variable=\"genre\" />          </else-if>          <else-if type=\"personal_communication\">            <text macro=\"issued\" />          </else-if>        </choose>      </if>      <else-if type=\"book\">        <text font-style=\"italic\" form=\"short\" variable=\"title\" />      </else-if>      <else>        <text form=\"short\" quotes=\"true\" variable=\"title\" />      </else>    </choose>  </macro>  <macro name=\"description-note\">    <group delimiter=\", \">      <text macro=\"interviewer-note\" />      <text variable=\"medium\" />      <choose>        <if match=\"none\" variable=\"title\"> </if>        <else-if match=\"any\" type=\"thesis speech\"> </else-if>        <else>          <text variable=\"genre\" />        </else>      </choose>    </group>  </macro>  <macro name=\"description\">    <group delimiter=\", \">      <group delimiter=\". \">        <text macro=\"interviewer\" />        <text text-case=\"capitalize-first\" variable=\"medium\" />      </group>      <choose>        <if match=\"none\" variable=\"title\"> </if>        <else-if match=\"any\" type=\"thesis speech\"> </else-if>        <else>          <text text-case=\"capitalize-first\" variable=\"genre\" />        </else>      </choose>    </group>  </macro>  <macro name=\"container-title-note\">    <choose>      <if type=\"chapter\">        <text suffix=\" \" term=\"in\" text-case=\"lowercase\" />      </if>    </choose>    <text font-style=\"italic\" variable=\"container-title\" form=\"short\"/>  </macro>  <macro name=\"container-title\">    <choose>      <if type=\"chapter\">        <text suffix=\" \" term=\"in\" text-case=\"capitalize-first\" />      </if>    </choose>    <text font-style=\"italic\" variable=\"container-title\" form=\"short\"/>  </macro>  <macro name=\"collection-title\">    <text variable=\"collection-title\" />    <text prefix=\" \" variable=\"collection-number\" />  </macro>  <macro name=\"edition-note\">    <choose>      <if match=\"any\" type=\"book chapter\">        <choose>          <if is-numeric=\"edition\">            <group delimiter=\" \">              <number form=\"ordinal\" variable=\"edition\" />              <text form=\"short\" suffix=\".\" term=\"edition\" />            </group>          </if>          <else>            <text suffix=\".\" variable=\"edition\" />          </else>        </choose>      </if>    </choose>  </macro>  <macro name=\"edition\">    <choose>      <if match=\"any\" type=\"book chapter\">        <choose>          <if is-numeric=\"edition\">            <group delimiter=\" \">              <number form=\"ordinal\" variable=\"edition\" />              <text form=\"short\" suffix=\".\" term=\"edition\" />            </group>          </if>          <else>            <text suffix=\".\" text-case=\"capitalize-first\" variable=\"edition\" />          </else>        </choose>      </if>    </choose>  </macro>  <macro name=\"locators-note\">    <choose>      <if type=\"article-journal\">        <text prefix=\" \" variable=\"volume\" />        <text prefix=\", no. \" variable=\"issue\" />      </if>      <else-if match=\"any\" type=\"book chapter\">        <group delimiter=\", \" prefix=\", \">          <group>            <text form=\"short\" suffix=\". \" term=\"volume\" />            <number form=\"numeric\" variable=\"volume\" />          </group>          <choose>            <if match=\"none\" variable=\"locator\">              <group>                <number form=\"numeric\" variable=\"number-of-volumes\" />                <text form=\"short\" plural=\"true\" prefix=\" \" suffix=\".\" term=\"volume\" />              </group>            </if>          </choose>          <text macro=\"edition-note\" />        </group>      </else-if>    </choose>  </macro>  <macro name=\"locators\">    <choose>      <if type=\"article-journal\">        <text prefix=\" \" variable=\"volume\" />        <text prefix=\", no. \" variable=\"issue\" />      </if>      <else-if match=\"any\" type=\"book\">        <group delimiter=\". \" prefix=\". \">          <group>            <text form=\"short\" suffix=\". \" term=\"volume\" text-case=\"capitalize-first\" />            <number form=\"numeric\" variable=\"volume\" />          </group>          <group>            <number form=\"numeric\" variable=\"number-of-volumes\" />            <text form=\"short\" plural=\"true\" prefix=\" \" suffix=\".\" term=\"volume\" />          </group>          <text macro=\"edition\" />        </group>      </else-if>    </choose>  </macro>  <macro name=\"locators-newspaper\">    <choose>      <if type=\"article-newspaper\">        <group delimiter=\", \">          <group>            <text suffix=\" \" variable=\"edition\" />            <text prefix=\" \" term=\"edition\" />          </group>          <group>            <text form=\"short\" suffix=\". \" term=\"section\" />            <text variable=\"section\" />          </group>        </group>      </if>    </choose>  </macro>  <macro name=\"event\">    <group>      <text suffix=\" \" term=\"presented at\" />      <text variable=\"event\" />    </group>  </macro>  <macro name=\"publisher\">    <group delimiter=\": \">      <text variable=\"publisher-place\" />      <text variable=\"publisher\" />    </group>  </macro>  <macro name=\"issued\">    <choose>      <if match=\"any\" type=\"graphic report\">        <date variable=\"issued\">          <date-part name=\"month\" suffix=\" \" />          <date-part name=\"day\" suffix=\", \" />          <date-part name=\"year\" />        </date>      </if>      <else-if match=\"any\" type=\"book chapter thesis\">        <date variable=\"issued\">          <date-part name=\"year\" />        </date>      </else-if>      <else>        <date variable=\"issued\">          <date-part name=\"month\" suffix=\" \" />          <date-part name=\"day\" suffix=\", \" />          <date-part name=\"year\" />        </date>      </else>    </choose>  </macro>  <macro name=\"point-locators-subsequent\">    <group>      <choose>        <if locator=\"page\" match=\"none\">          <label form=\"short\" strip-periods=\"false\" suffix=\" \" variable=\"locator\" />        </if>      </choose>      <text variable=\"locator\" />    </group>  </macro>  <macro name=\"point-locators\">    <choose>      <if match=\"none\" variable=\"locator\">        <text macro=\"pages\" />      </if>      <else-if type=\"article-journal\">        <text prefix=\": \" variable=\"locator\" />      </else-if>      <else>        <text macro=\"point-locators-subsequent\" prefix=\", \" />      </else>    </choose>  </macro>  <macro name=\"pages\">    <choose>      <if type=\"article-journal\">        <text prefix=\": \" variable=\"page\" />      </if>      <else-if type=\"chapter\">        <text prefix=\", \" variable=\"page\" />      </else-if>    </choose>  </macro>  <macro name=\"locators-chapter\">    <choose>      <if type=\"chapter\">        <text suffix=\":\" variable=\"volume\" />        <text variable=\"page\" />      </if>    </choose>  </macro>  <macro name=\"locators-journal\">    <choose>      <if type=\"article-journal\">        <text prefix=\": \" variable=\"page\" />      </if>    </choose>  </macro>  <macro name=\"archive-note\">    <group delimiter=\", \">      <text variable=\"archive_location\" />      <text variable=\"archive\" />      <text variable=\"archive-place\" />    </group>  </macro>  <macro name=\"archive\">    <group delimiter=\". \">      <text text-case=\"capitalize-first\" variable=\"archive_location\" />      <text variable=\"archive\" />      <text variable=\"archive-place\" />    </group>  </macro>  <macro name=\"issue-note\">    <choose>      <if type=\"article-journal\">        <text macro=\"issued\" prefix=\" (\" suffix=\")\" />      </if>      <else-if match=\"any\" variable=\"publisher-place publisher\">        <group delimiter=\", \" prefix=\" (\" suffix=\")\">          <group delimiter=\" \">            <choose>              <if match=\"none\" variable=\"title\"> </if>              <else-if match=\"any\" type=\"thesis speech\">                <text variable=\"genre\" />              </else-if>            </choose>            <text macro=\"event\" />          </group>          <text macro=\"publisher\" />          <text macro=\"issued\" />        </group>      </else-if>      <else>        <text macro=\"issued\" prefix=\", \" />      </else>    </choose>  </macro>  <macro name=\"issue\">    <choose>      <if type=\"article-journal\">        <text macro=\"issued\" prefix=\" (\" suffix=\")\" />      </if>      <else-if type=\"speech\">        <choose>          <if match=\"none\" variable=\"title\"> </if>          <else>            <text prefix=\". \" text-case=\"capitalize-first\" variable=\"genre\" />          </else>        </choose>        <text macro=\"event\" prefix=\" \" />        <text prefix=\", \" variable=\"event-place\" />        <text macro=\"issued\" prefix=\", \" />      </else-if>      <else-if match=\"any\" variable=\"publisher-place publisher\">        <group delimiter=\", \" prefix=\". \">          <choose>            <if type=\"thesis\">              <text text-case=\"capitalize-first\" variable=\"genre\" />            </if>          </choose>          <text macro=\"publisher\" />          <text macro=\"issued\" />        </group>      </else-if>      <else>        <text macro=\"issued\" prefix=\", \" />      </else>    </choose>  </macro>  <macro name=\"access-note\">    <group delimiter=\", \">      <choose>        <if match=\"any\" type=\"graphic report\">          <text macro=\"archive-note\" />        </if>        <else-if match=\"none\" type=\"book thesis chapter article-journal article-newspaper article-magazine\">          <text macro=\"archive-note\" />        </else-if>      </choose>      <text prefix=\"doi:\" variable=\"DOI\" />      <text variable=\"URL\" />    </group>  </macro>  <macro name=\"access\">    <group delimiter=\". \">      <choose>        <if match=\"any\" type=\"graphic report\">          <text macro=\"archive\" />        </if>        <else-if match=\"none\" type=\"book thesis chapter article-journal article-newspaper article-magazine\">          <text macro=\"archive\" />        </else-if>      </choose>      <text variable=\"URL\" />    </group>  </macro>  <macro name=\"sort-key\">    <text macro=\"contributors-sort\" suffix=\" \" />    <text suffix=\" \" variable=\"title\" />    <text variable=\"genre\" />  </macro>  <citation          disambiguate-add-names=\"true\"         et-al-min=\"4\"         et-al-subsequent-min=\"4\"         et-al-subsequent-use-first=\"1\"         et-al-use-first=\"1\">    <layout delimiter=\"; \" prefix=\"\" suffix=\".\">      <choose>        <if position=\"ibid-with-locator\">          <group delimiter=\", \">            <text suffix=\".\" term=\"ibid\" text-case=\"capitalize-first\" />            <text macro=\"point-locators-subsequent\" />          </group>        </if>        <else-if position=\"ibid\">          <text suffix=\".\" term=\"ibid\" text-case=\"capitalize-first\" />        </else-if>        <else-if position=\"subsequent\">          <group delimiter=\", \">            <text macro=\"contributors-short\" />            <text macro=\"title-short\" />            <text macro=\"point-locators-subsequent\" />          </group>        </else-if>        <else>          <group delimiter=\", \">            <text macro=\"contributors-note\" />            <text macro=\"title-note\" />            <text macro=\"description-note\" />            <text macro=\"secondary-contributors-note\" />            <text macro=\"container-title-note\" />            <text macro=\"container-contributors-note\" />          </group>          <text macro=\"locators-note\" />          <text macro=\"collection-title\" prefix=\", \" />          <text macro=\"issue-note\" />          <text macro=\"locators-newspaper\" prefix=\", \" />          <text macro=\"point-locators\" />          <text macro=\"access-note\" prefix=\", \" />        </else>      </choose>    </layout>  </citation>  <bibliography          entry-spacing=\"0\"         et-al-min=\"11\"         et-al-use-first=\"7\"         hanging-indent=\"true\"         subsequent-author-substitute=\"---\">    <sort>      <key macro=\"sort-key\" />      <key variable=\"issued\" />    </sort>    <layout>     <group display=\"block\" suffix=\".\"> <group delimiter=\". \">        <text macro=\"contributors\" />        <text macro=\"title\" />        <text macro=\"description\" />        <text macro=\"secondary-contributors\" />        <group delimiter=\", \">          <text macro=\"container-title\"/>          <text macro=\"container-contributors\" />          <text macro=\"locators-chapter\" />        </group>      </group>      <text macro=\"locators\" />      <text macro=\"collection-title\" prefix=\". \" />      <text macro=\"issue\" />      <text macro=\"locators-newspaper\" prefix=\", \" />      <text macro=\"locators-journal\" />      <text macro=\"access\" prefix=\". \" /> </group> <text variable=\"note\" font-style=\"italic\" display=\"indent\"/>    </layout>  </bibliography></style>";
  load_csl_for_javascript($variable_name, $csl);
  
  $variable_name='ieee';
  $csl="<style        xmlns=\"http://purl.org/net/xbiblio/csl\"       class=\"in-text\">   <info>     <title>IEEE</title>     <id>http://www.zotero.org/styles/ieee</id>     <link href=\"http://www.zotero.org/styles/ieee\" />     <author>       <name>Michael Berkowitz</name>       <email>mberkowi@gmu.edu</email>     </author>     <contributor>       <name>Julian Onions</name>       <email>julian.onions@gmail.com</email>     </contributor>     <contributor>       <name>Rintze Zelle</name>       <uri>http://forums.zotero.org/account/831/</uri>     </contributor>     <category term=\"engineering\" />     <category term=\"generic-base\" />     <category term=\"numeric\" />     <updated />     <link href=\"http://www.ieee.org/portal/cms_docs_iportals/iportals/publications/authors/transjnl/stylemanual.pdf\" rel=\"documentation\" />   </info>   <macro name=\"author\">     <names variable=\"author\">       <name and=\"text\" delimiter=\", \" initialize-with=\".\"/>       <label form=\"short\" prefix=\", \" suffix=\".\" text-case=\"lowercase\" />       <substitute>         <names variable=\"editor\" />         <names variable=\"translator\" />       </substitute>     </names>   </macro>   <macro name=\"editor\">     <names variable=\"editor\">       <name and=\"text\" delimiter=\", \" initialize-with=\".\" name-as-sort-order=\"all\" />       <label form=\"short\" prefix=\", \" suffix=\".\" text-case=\"lowercase\" />     </names>   </macro>   <macro name=\"title\">     <choose>       <if type=\"book\">         <text font-style=\"italic\" variable=\"title\" />       </if>       <else>         <text quotes=\"true\" variable=\"title\" />       </else>     </choose>   </macro>   <macro name=\"publisher\">     <text prefix=\" \" suffix=\": \" variable=\"publisher-place\" />     <text suffix=\", \" variable=\"publisher\" />     <date variable=\"issued\">       <date-part name=\"year\" />     </date>   </macro>   <macro name=\"access\">     <text variable=\"URL\" />   </macro>   <macro name=\"page\">     <group>       <label form=\"short\" suffix=\". \" variable=\"page\" />       <text variable=\"page\" />     </group>   </macro>   <citation           collapse=\"citation-number\"          et-al-min=\"3\"          et-al-use-first=\"1\">     <sort>       <key variable=\"citation-number\" />     </sort>     <layout delimiter=\",\" prefix=\"[\" suffix=\"]\">       <text variable=\"citation-number\" />     </layout>   </citation>   <bibliography           entry-spacing=\"0\"          second-field-align=\"flush\">     <layout suffix=\".\">       <text prefix=\"[\" suffix=\"]\" variable=\"citation-number\" />       <text macro=\"author\" prefix=\" \" suffix=\", \" />       <choose>         <if type=\"book\">           <group delimiter=\", \">             <text macro=\"title\" />             <text macro=\"publisher\" />           </group>         </if>         <else-if type=\"chapter\">           <group delimiter=\", \">             <text macro=\"title\" />             <text font-style=\"italic\" variable=\"container-title\" form=\"short\"/>             <text macro=\"editor\" />             <text macro=\"publisher\" />             <text macro=\"page\" />           </group>         </else-if>         <else-if type=\"patent\">           <text macro=\"title\" suffix=\", \" />           <text prefix=\"U.S. Patent \" variable=\"number\" />           <date prefix=\", \" variable=\"issued\">             <date-part name=\"month\" suffix=\" \" />             <date-part name=\"day\" suffix=\", \" />             <date-part name=\"year\" />           </date>         </else-if>         <else-if type=\"thesis\">           <group delimiter=\", \">             <text macro=\"title\" />             <text variable=\"genre\" />             <text variable=\"publisher\" />             <date variable=\"issued\">               <date-part name=\"year\" />             </date>           </group>         </else-if>         <else>           <group delimiter=\", \">             <text macro=\"title\" />             <text font-style=\"italic\" variable=\"container-title\" form=\"short\"/>             <text prefix=\" vol. \" variable=\"volume\" />             <date variable=\"issued\">               <date-part form=\"short\" name=\"month\" suffix=\". \" />               <date-part name=\"year\" />             </date>             <text macro=\"page\" />           </group>         </else>       </choose>     </layout>   </bibliography> </style>";
  load_csl_for_javascript($variable_name, $csl);
  
  $variable_name='chicago_author_date_listing';
  $csl="<style       xmlns=\"http://purl.org/net/xbiblio/csl\"      class=\"in-text\"      version=\"1.0\"	  default-locale=\"en-US-x-sort-ja-alalc97\">  <info>    <title>Chicago Manual of Style (Author-Date format)</title>    <id>http://www.zotero.org/styles/chicago-author-date</id>    <link rel=\"self\" href=\"http://www.zotero.org/styles/chicago-author-date\" />    <author>      <name>Julian Onions</name>      <email>julian.onions@gmail.com</email>    </author>    <category citation-format=\"author-date\" />    <category field=\"generic-base\" />    <updated>2009-08-10T04:49:00+09:00</updated>    <summary>The author-date variant of the Chicago style</summary>    <link href=\"http://www.chicagomanualofstyle.org/tools_citationguide.html\" rel=\"documentation\" />  </info>  <locale>    <terms>	  <term name=\"and others\"></term>      <term name=\"contributor\"></term>	</terms>  </locale>  <macro name=\"secondary-contributors\">    <choose>      <if match=\"none\" type=\"chapter\">        <group delimiter=\". \">          <choose>            <if variable=\"author\">              <names variable=\"editor\">                <label form=\"verb-short\" prefix=\" \" suffix=\". \" text-case=\"capitalize-first\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>          <choose>            <if match=\"any\" variable=\"author editor\">              <names variable=\"translator\">                <label form=\"verb-short\" prefix=\" \" suffix=\". \" text-case=\"capitalize-first\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>        </group>      </if>    </choose>  </macro>  <macro name=\"container-contributors\">    <choose>      <if type=\"chapter\">        <group delimiter=\", \" prefix=\",\">          <choose>            <if variable=\"author\">              <names variable=\"editor\">                <label form=\"verb-short\" prefix=\" \" suffix=\". \" text-case=\"lowercase\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>          <choose>            <if match=\"any\" variable=\"author editor\">              <names variable=\"translator\">                <label form=\"verb-short\" prefix=\" \" suffix=\". \" text-case=\"lowercase\" />                <name and=\"text\" delimiter=\", \" />              </names>            </if>          </choose>        </group>      </if>    </choose>  </macro>  <macro name=\"anon\">    <choose>      <if match=\"none\" variable=\"author editor translator\">        <text form=\"short\" term=\"anonymous\" text-case=\"capitalize-first\" />      </if>    </choose>  </macro>  <macro name=\"editor\">    <names variable=\"editor\">      <name and=\"text\" delimiter=\", \" delimiter-precedes-last=\"always\" name-as-sort-order=\"first\" sort-separator=\", \" />      <label form=\"short\" prefix=\", \" suffix=\".\" />    </names>  </macro>  <macro name=\"translator\">    <names variable=\"translator\">      <name and=\"text\" delimiter=\", \" delimiter-precedes-last=\"always\" name-as-sort-order=\"first\" sort-separator=\", \" />      <label form=\"verb-short\" prefix=\", \" suffix=\".\" />    </names>  </macro>  <macro name=\"recipient\">    <choose>      <if type=\"personal_communication\">        <choose>          <if variable=\"genre\">            <text text-case=\"capitalize-first\" variable=\"genre\" />          </if>          <else>            <text term=\"letter\" text-case=\"capitalize-first\" />          </else>        </choose>      </if>    </choose>    <names delimiter=\", \" variable=\"recipient\">      <label form=\"verb\" prefix=\" \" suffix=\" \" text-case=\"lowercase\" />      <name and=\"text\" delimiter=\", \" />    </names>  </macro>  <macro name=\"contributors\">    <names variable=\"author\">      <name and=\"text\" delimiter=\", \" delimiter-precedes-last=\"always\" />      <label form=\"verb-short\" prefix=\", \" suffix=\".\" text-case=\"lowercase\" />      <substitute>        <text macro=\"editor\" />        <text macro=\"translator\" />      </substitute>    </names>    <text macro=\"anon\" />    <text macro=\"recipient\" />  </macro>  <macro name=\"headline-contributor\">    <names variable=\"contributor\">      <name and=\"text\" delimiter=\", \" 			delimiter-precedes-last=\"always\" 			name-as-sort-order=\"first\" 			sort-separator=\", \"  			et-al-use-first=\"1\" 			et-al-min=\"2\"/>	  <et-al term=\"and others\"/>      <label form=\"verb-short\" prefix=\", \" suffix=\".\" text-case=\"lowercase\" />    </names>  </macro>  <macro name=\"headline-author\">    <names variable=\"author\">      <name and=\"text\" delimiter=\", \" 			delimiter-precedes-last=\"always\" 			name-as-sort-order=\"first\" 			sort-separator=\", \"  			et-al-use-first=\"1\" 			et-al-min=\"2\"/>	  <et-al term=\"and others\"/>      <label form=\"verb-short\" prefix=\", \" suffix=\".\" text-case=\"lowercase\" />      <substitute>        <text macro=\"editor\" />        <text macro=\"translator\" />      </substitute>    </names>    <text macro=\"anon\" />    <text macro=\"recipient\" />  </macro>  <macro name=\"contributors-short\">    <names variable=\"author\">      <name and=\"text\" delimiter=\", \" form=\"short\" />      <substitute>        <names variable=\"editor\" />        <names variable=\"translator\" />      </substitute>    </names>    <text macro=\"anon\" />  </macro>  <macro name=\"interviewer\">    <names delimiter=\", \" variable=\"interviewer\">      <label form=\"verb\" prefix=\" \" suffix=\" \" text-case=\"capitalize-first\" />      <name and=\"text\" delimiter=\", \" />    </names>  </macro>  <macro name=\"archive\">    <group delimiter=\". \">      <text text-case=\"capitalize-first\" variable=\"archive_location\" />      <text variable=\"archive\" />      <text variable=\"archive-place\" />    </group>  </macro>  <macro name=\"access\">    <group delimiter=\". \">      <choose>        <if match=\"any\" type=\"graphic report\">          <text macro=\"archive\" />        </if>        <else-if match=\"none\" type=\"book thesis chapter article-journal article-newspaper article-magazine\">          <text macro=\"archive\" />        </else-if>      </choose>      <text prefix=\"doi:\" variable=\"DOI\" />      <text variable=\"URL\" />    </group>  </macro>  <macro name=\"title\">    <choose>      <if match=\"none\" variable=\"title\">        <choose>          <if match=\"none\" type=\"personal_communication\">            <text text-case=\"capitalize-first\" variable=\"genre\" />          </if>        </choose>      </if>      <else-if type=\"book\">        <text font-style=\"italic\" variable=\"title\" />      </else-if>      <else>        <text variable=\"title\" />      </else>    </choose>  </macro>  <macro name=\"edition\">    <choose>      <if match=\"any\" type=\"book chapter\">        <choose>          <if is-numeric=\"edition\">            <group delimiter=\" \">              <number form=\"ordinal\" variable=\"edition\" />              <text form=\"short\" suffix=\".\" term=\"edition\" />            </group>          </if>          <else>            <text suffix=\".\" variable=\"edition\" />          </else>        </choose>      </if>    </choose>  </macro>  <macro name=\"locators\">    <choose>      <if type=\"article-journal\">        <text prefix=\" \" variable=\"volume\" />        <text prefix=\", no. \" variable=\"issue\" />      </if>      <else-if type=\"book\">        <group delimiter=\". \" prefix=\". \">          <group>            <text form=\"short\" suffix=\". \" term=\"volume\" text-case=\"capitalize-first\" />            <number form=\"numeric\" variable=\"volume\" />          </group>          <group>            <number form=\"numeric\" variable=\"number-of-volumes\" />            <text form=\"short\" plural=\"true\" prefix=\" \" suffix=\".\" term=\"volume\" />          </group>        </group>      </else-if>    </choose>  </macro>  <macro name=\"locators-chapter\">    <choose>      <if type=\"chapter\">        <group prefix=\", \">          <text suffix=\":\" variable=\"volume\" />          <text variable=\"page\" />        </group>      </if>    </choose>  </macro>  <macro name=\"locators-article\">    <choose>      <if type=\"article-newspaper\">        <group delimiter=\", \" prefix=\", \">          <group>            <text suffix=\" \" variable=\"edition\" />            <text prefix=\" \" term=\"edition\" />          </group>          <group>            <text form=\"short\" suffix=\". \" term=\"section\" />            <text variable=\"section\" />          </group>        </group>      </if>      <else-if type=\"article-journal\">        <text prefix=\": \" variable=\"page\" />      </else-if>    </choose>  </macro>  <macro name=\"point-locators\">    <group>      <choose>        <if locator=\"page\" match=\"none\">          <label form=\"short\" strip-periods=\"false\" suffix=\" \" variable=\"locator\" />        </if>      </choose>      <text variable=\"locator\" />    </group>  </macro>  <macro name=\"container-prefix\">    <text term=\"in\" text-case=\"capitalize-first\" />  </macro>  <macro name=\"container-title\">    <choose>      <if type=\"chapter\">        <text macro=\"container-prefix\" suffix=\" \" />      </if>    </choose>    <text font-style=\"italic\" variable=\"container-title\" />  </macro>  <macro name=\"publisher\">    <group delimiter=\": \">      <text variable=\"publisher-place\" />      <text variable=\"publisher\" />    </group>  </macro>  <macro name=\"date\">    <date variable=\"issued\">      <date-part name=\"year\" />    </date>  </macro>  <macro name=\"day-month\">    <date variable=\"issued\">      <date-part name=\"month\" />      <date-part name=\"day\" prefix=\" \" />    </date>  </macro>  <macro name=\"collection-title\">    <text variable=\"collection-title\" />    <text prefix=\" \" variable=\"collection-number\" />  </macro>  <macro name=\"event\">    <group>      <text suffix=\" \" term=\"presented at\" />      <text variable=\"event\" />    </group>  </macro>  <macro name=\"description\">    <group delimiter=\". \">      <text macro=\"interviewer\" />      <text text-case=\"capitalize-first\" variable=\"medium\" />    </group>    <choose>      <if match=\"none\" variable=\"title\"> </if>      <else-if type=\"thesis\"> </else-if>      <else>        <text prefix=\". \" text-case=\"capitalize-first\" variable=\"genre\" />      </else>    </choose>  </macro>  <macro name=\"issue\">    <choose>      <if type=\"article-journal\">        <text macro=\"day-month\" prefix=\" (\" suffix=\")\" />      </if>      <else-if type=\"speech\">        <group delimiter=\", \" prefix=\" \">          <text macro=\"event\" />          <text macro=\"day-month\" />          <text variable=\"event-place\" />        </group>      </else-if>      <else-if match=\"any\" type=\"article-newspaper article-magazine\">        <text macro=\"day-month\" prefix=\", \" />      </else-if>      <else>        <group delimiter=\", \" prefix=\". \">          <choose>            <if type=\"thesis\">              <text text-case=\"capitalize-first\" variable=\"genre\" />            </if>          </choose>          <text macro=\"publisher\" />          <text macro=\"day-month\" />        </group>      </else>    </choose>  </macro>  <macro name=\"headline\">	<choose>	  <if variable=\"contributor\">		<text macro=\"headline-contributor\"/>	  </if>	  <else>		<text macro=\"headline-author\"/>	  </else>	</choose>  </macro>  <citation          disambiguate-add-givenname=\"true\"         disambiguate-add-names=\"true\"         disambiguate-add-year-suffix=\"true\"         et-al-min=\"4\"         et-al-subsequent-min=\"4\"         et-al-subsequent-use-first=\"1\"         et-al-use-first=\"1\">    <layout delimiter=\"; \" prefix=\"(\" suffix=\")\">      <group delimiter=\", \">        <group delimiter=\" \">          <text macro=\"contributors-short\" />          <text macro=\"date\" />        </group>        <text macro=\"point-locators\" />      </group>    </layout>  </citation>  <bibliography          entry-spacing=\"0\"         et-al-min=\"11\"         et-al-use-first=\"7\"         hanging-indent=\"true\"         subsequent-author-substitute=\"\">	<sort>	  <key macro=\"headline\" 		   names-min=\"1\" 		   names-use-first=\"1\" 		   sort=\"ascending\"/>	  <key variable=\"issued\"		   sort=\"descending\"/>	</sort>    <layout>      <text macro=\"headline\" display=\"block\"/>              <group display=\"left-margin\">        <text macro=\"date\" />	  </group>      <group display=\"right-inline\">        <group suffix=\".\">          <text macro=\"title\" />          <text macro=\"description\" />          <text macro=\"secondary-contributors\" prefix=\". \" />          <text macro=\"container-title\" prefix=\". \" />          <text macro=\"container-contributors\" />          <text macro=\"locators-chapter\" />          <text macro=\"edition\" prefix=\". \" />          <text macro=\"locators\" />          <text macro=\"collection-title\" prefix=\". \" />          <text macro=\"issue\" />          <text macro=\"locators-article\" />          <text macro=\"access\" prefix=\". \" />		</group>        <group prefix=\" (\" suffix=\")\" delimiter=\" \">          <choose>            <if variable=\"contributor\">              <text prefix=\"co-author among: \" macro=\"contributors\"/>			</if>            <else>  		      <text prefix=\"co-authorship: \" macro=\"contributors\"/>			</else>		  </choose>	    </group>	  </group>    </layout>  </bibliography></style>";
  load_csl_for_javascript($variable_name, $csl);
  
  
  
  //abreviations
  $name='default';
  $var_type='container-title';
  $abbreviation_data='{"Pacific Rim Law & Policy Journal":"Pac. Rim L. & Pol\u2019y J.","\u65e5\u672c\u6559\u80b2\u5de5\u5b66\u4f1a\u8ad6\u6587\u8a8c":"\u65e5\u6559\u8ad6\u8a8c","Journal of the Japan Educational Engineering Society":"J. Japan Educ. Engineering Soc.","Applied and Environmental Microbiology":"Applied and Environmental Microbiology"}';
  load_abbreviation($name, $var_type, $abbreviation_data);
  
  $var_type='collection-title';  
  $abbreviation_data='{"International Rescue Wildlife Series":"I.R. Wildlife Series"}';
  load_abbreviation($name, $var_type, $abbreviation_data);
  
  $var_type="authority";
  $abbreviation_data='{"United Nations": "U.N."}';
  load_abbreviation($name, $var_type, $abbreviation_data);
  
  $var_type="institution";
  $abbreviation_data='{"U.S. Bureau of the Census":"U.S. Bureau of the Census"}';
  load_abbreviation($name, $var_type, $abbreviation_data);
  
  $name="slightly_weird";
  $var_type='container-title';
  $abbreviation_data='{"Pacific Rim Law & Policy Journal":"PRL & PJ","\u65e5\u672c\u6559\u80b2\u5de5\u5b66\u4f1a\u8ad6\u6587\u8a8c":"\u65e5\u6559\u8ad6","Journal of the Japan Educational Engineering Society":"J. Japan Educ. Eng. Soc.","Applied and Environmental Microbiology":"Appl\'d. & Env\'tal Microbio."}';
  load_abbreviation($name, $var_type, $abbreviation_data);
  
  $var_type='collection-title';  
  $abbreviation_data='{"International Rescue Wildlife Series":"I.R. Wildlife Series"}';
  load_abbreviation($name, $var_type, $abbreviation_data);
  
  $var_type="authority";
  $abbreviation_data='{"United Nations": "U.N."}';
  load_abbreviation($name, $var_type, $abbreviation_data);
  
  $var_type="institution";
  $abbreviation_data='{"U.S. Bureau of the Census":"U.S. Bureau of the Census"}';
  load_abbreviation($name, $var_type, $abbreviation_data);
  
  /*
  //removed due to conflict with oo api
  //localizations
  $lang="en-US";
  $locale="<locale xml:lang=\"en\" xmlns=\"http://purl.org/net/xbiblio/csl\">  <style-options punctuation-in-quote=\"true\"/>  <date form=\"text\">    <date-part name=\"month\" suffix=\" \"/>    <date-part name=\"day\" suffix=\", \"/>    <date-part name=\"year\"/>  </date>  <date form=\"numeric\">    <date-part name=\"year\"/>    <date-part name=\"month\" form=\"numeric\" prefix=\"-\" range-delimiter=\"/\"/>    <date-part name=\"day\" prefix=\"-\" range-delimiter=\"/\"/>  </date>  <terms>    <term name=\"document-number-label\">No.</term>    <term name=\"document-number-authority-suffix\">Doc.</term>    <term name=\"un-sales-number-label\">U.N. Sales No.</term>    <term name=\"collection-number-label\">No.</term>    <term name=\"open-quote\">\u201c</term>    <term name=\"close-quote\">\u201d</term>    <term name=\"open-inner-quote\">\u2018</term>    <term name=\"close-inner-quote\">\u2019</term>    <term name=\"ordinal-01\">st</term>    <term name=\"ordinal-02\">nd</term>    <term name=\"ordinal-03\">rd</term>    <term name=\"ordinal-04\">th</term>    <term name=\"long-ordinal-01\">first</term>    <term name=\"long-ordinal-02\">second</term>    <term name=\"long-ordinal-03\">third</term>    <term name=\"long-ordinal-04\">fourth</term>    <term name=\"long-ordinal-05\">fifth</term>    <term name=\"long-ordinal-06\">sixth</term>    <term name=\"long-ordinal-07\">seventh</term>    <term name=\"long-ordinal-08\">eighth</term>    <term name=\"long-ordinal-09\">ninth</term>    <term name=\"long-ordinal-10\">tenth</term>    <term name=\"at\">at</term>    <term name=\"in\">in</term>    <term name=\"ibid\">ibid</term>    <term name=\"accessed\">accessed</term>    <term name=\"retrieved\">retrieved</term>    <term name=\"from\">from</term>    <term name=\"forthcoming\">forthcoming</term>    <term name=\"references\">      <single>reference</single>      <multiple>references</multiple>    </term>    <term name=\"references\" form=\"short\">      <single>ref</single>      <multiple>refs</multiple>    </term>    <term name=\"no date\">n.d.</term>    <term name=\"and\">and</term>    <term name=\"et-al\">et al.</term>    <term name=\"interview\">interview</term>    <term name=\"letter\">letter</term>    <term name=\"anonymous\">anonymous</term>    <term name=\"anonymous\" form=\"short\">anon.</term>    <term name=\"and others\">and others</term>    <term name=\"in press\">in press</term>    <term name=\"online\">online</term>    <term name=\"cited\">cited</term>    <term name=\"internet\">internet</term>    <term name=\"presented at\">presented at the</term>    <term name=\"ad\">AD</term>    <term name=\"bc\">BC</term>    <term name=\"season-01\">Spring</term>    <term name=\"season-02\">Summer</term>    <term name=\"season-03\">Autumn</term>    <term name=\"season-04\">Winter</term>    <term name=\"with\">with</term>        <!-- CATEGORIES -->    <term name=\"anthropology\">anthropology</term>    <term name=\"astronomy\">astronomy</term>    <term name=\"biology\">biology</term>    <term name=\"botany\">botany</term>    <term name=\"chemistry\">chemistry</term>    <term name=\"engineering\">engineering</term>    <term name=\"generic-base\">generic base</term>    <term name=\"geography\">geography</term>    <term name=\"geology\">geology</term>    <term name=\"history\">history</term>    <term name=\"humanities\">humanities</term>    <term name=\"literature\">literature</term>    <term name=\"math\">math</term>    <term name=\"medicine\">medicine</term>    <term name=\"philosophy\">philosophy</term>    <term name=\"physics\">physics</term>    <term name=\"psychology\">psychology</term>    <term name=\"sociology\">sociology</term>    <term name=\"science\">science</term>    <term name=\"political_science\">political science</term>    <term name=\"social_science\">social science</term>    <term name=\"theology\">theology</term>    <term name=\"zoology\">zoology</term>        <!-- LONG LOCATOR FORMS -->    <term name=\"book\">      <single>book</single>      <multiple>books</multiple>    </term>    <term name=\"chapter\">      <single>chapter</single>      <multiple>chapters</multiple>    </term>    <term name=\"column\">      <single>column</single>      <multiple>columns</multiple>    </term>    <term name=\"figure\">      <single>figure</single>      <multiple>figures</multiple>    </term>    <term name=\"folio\">      <single>folio</single>      <multiple>folios</multiple>    </term>    <term name=\"issue\">      <single>number</single>      <multiple>numbers</multiple>    </term>    <term name=\"line\">      <single>line</single>      <multiple>lines</multiple>    </term>    <term name=\"note\">      <single>note</single>      <multiple>notes</multiple>    </term>    <term name=\"opus\">      <single>opus</single>      <multiple>opera</multiple>    </term>    <term name=\"page\">      <single>page</single>      <multiple>pages</multiple>    </term>    <term name=\"paragraph\">      <single>paragraph</single>      <multiple>paragraph</multiple>    </term>    <term name=\"part\">      <single>part</single>      <multiple>parts</multiple>    </term>    <term name=\"section\">      <single>section</single>      <multiple>sections</multiple>    </term>    <term name=\"volume\">      <single>volume</single>      <multiple>volumes</multiple>    </term>    <term name=\"edition\">      <single>edition</single>      <multiple>editions</multiple>    </term>    <term name=\"verse\">      <single>verse</single>      <multiple>verses</multiple>    </term>    <term name=\"sub verbo\">      <single>sub verbo</single>      <multiple>s.vv</multiple>    </term>        <!-- SHORT LOCATOR FORMS -->    <term name=\"book\" form=\"short\">bk.</term>    <term name=\"chapter\" form=\"short\">chap.</term>    <term name=\"column\" form=\"short\">col.</term>    <term name=\"figure\" form=\"short\">fig.</term>    <term name=\"folio\" form=\"short\">f.</term>    <term name=\"issue\" form=\"short\">no.</term>    <term name=\"opus\" form=\"short\">op.</term>    <term name=\"page\" form=\"short\">      <single>p.</single>      <multiple>pp.</multiple>    </term>    <term name=\"paragraph\" form=\"short\">para.</term>    <term name=\"part\" form=\"short\">pt.</term>    <term name=\"section\" form=\"short\">sec.</term>    <term name=\"sub verbo\" form=\"short\">      <single>s.v.</single>      <multiple>s.vv.</multiple>    </term>    <term name=\"verse\" form=\"short\">      <single>v.</single>      <multiple>vv.</multiple>    </term>    <term name=\"volume\" form=\"short\">    	<single>vol.</single>    	<multiple>vols.</multiple>    </term>    <term name=\"edition\">edition</term>    <term name=\"edition\" form=\"short\">ed.</term>        <!-- SYMBOL LOCATOR FORMS -->    <term name=\"paragraph\" form=\"symbol\">      <single>¶</single>      <multiple>¶¶</multiple>    </term>    <term name=\"section\" form=\"symbol\">      <single>§</single>      <multiple>§§</multiple>    </term>        <!-- LONG ROLE FORMS -->    <term name=\"author\">      <single></single>      <multiple></multiple>    </term>    <term name=\"editor\">      <single>editor</single>      <multiple>editors</multiple>    </term>    <term name=\"translator\">      <single>translator</single>      <multiple>translators</multiple>    </term>        <!-- SHORT ROLE FORMS -->    <term name=\"author\" form=\"short\">      <single></single>      <multiple></multiple>    </term>    <term name=\"editor\" form=\"short\">      <single>ed.</single>      <multiple>eds.</multiple>    </term>    <term name=\"translator\" form=\"short\">      <single>tran.</single>      <multiple>trans.</multiple>    </term>        <!-- VERB ROLE FORMS -->    <term name=\"editor\" form=\"verb\">edited by</term>    <term name=\"translator\" form=\"verb\">translated by</term>    <term name=\"recipient\" form=\"verb\">to</term>    <term name=\"interviewer\" form=\"verb\">interview by</term>        <!-- SHORT VERB ROLE FORMS -->    <term name=\"editor\" form=\"verb-short\">ed.</term>    <term name=\"translator\" form=\"verb-short\">trans.</term>        <!-- LONG MONTH FORMS -->    <term name=\"month-01\">January</term>    <term name=\"month-02\">February</term>    <term name=\"month-03\">March</term>    <term name=\"month-04\">April</term>    <term name=\"month-05\">May</term>    <term name=\"month-06\">June</term>    <term name=\"month-07\">July</term>    <term name=\"month-08\">August</term>    <term name=\"month-09\">September</term>    <term name=\"month-10\">October</term>    <term name=\"month-11\">November</term>    <term name=\"month-12\">December</term>        <!-- SHORT MONTH FORMS -->    <term name=\"month-01\" form=\"short\">Jan.</term>    <term name=\"month-02\" form=\"short\">Feb.</term>    <term name=\"month-03\" form=\"short\">Mar.</term>    <term name=\"month-04\" form=\"short\">Apr.</term>	<term name=\"month-05\" form=\"short\">May</term>    <term name=\"month-06\" form=\"short\">Jun.</term>    <term name=\"month-07\" form=\"short\">Jul.</term>    <term name=\"month-08\" form=\"short\">Aug.</term>    <term name=\"month-09\" form=\"short\">Sep.</term>    <term name=\"month-10\" form=\"short\">Oct.</term>    <term name=\"month-11\" form=\"short\">Nov.</term>    <term name=\"month-12\" form=\"short\">Dec.</term>  </terms></locale>";

  load_locale($lang, $locale);
  */
}

/**
 * moved for easy reading 
 */
function ir_citation_get_demo_html() {
  return '
	<h1>CSL Bibliography Samples</h1>

    <div class="heading">
       Chicago Author-Date (names sorted alphabetically, titles translated, no abbreviations, ambiguous name)
    </div>
    
    
    <p>
       Teren ald�on etelotya ep� ma, murm� leuca rempa nu loc, nar
       rax� estel naitya oa. <span id="cad1" class="ir_citation" data-ir_citation_style="chicago_author_date" data-ir_citation_object="citationCAD1"
       name="citation_cad">[cite]</span> Nu mir anca costa, arca rond�
       li�va �a huo. <span id="cad2" class="ir_citation" data-ir_citation_style="chicago_author_date" data-ir_citation_object="citationCAD2" name="citation_cad">[cite]</span>
       Aiw� pelentul tol s�. <span id="cad3" class="ir_citation" data-ir_citation_style="chicago_author_date" data-ir_citation_object="citationCAD3"
       name="citation_cad">[cite]</span> �a har� l�n� tenna mel, eques
       talta ataqua qua s�. <span id="cad4" class="ir_citation" data-ir_citation_style="chicago_author_date" data-ir_citation_object="citationCAD4"
       name="citation_cad">[cite]</span> �v� ataqua simpina caimass�
       us, sir ronyo haloit� tareldar et, n� man� mitta liquis
       eru. <span id="cad5" class="ir_citation" data-ir_citation_style="chicago_author_date" data-ir_citation_object="citationCAD5" name="citation_cad">[cite]</span> Oi t�p
       laic� nainany�na leryalehtya, sindar nostal� at
       axa. <span id="cad6" class="ir_citation" data-ir_citation_style="chicago_author_date" data-ir_citation_object="citationCAD6" name="citation_cad">[cite]</span> Wen
       namna sairon tellaur� er, hahta pend� quesset lia us, r� apa
       l�n� cotumo m�tima. <span id="cad7" class="ir_citation" data-ir_citation_style="chicago_author_date" data-ir_citation_object="citationCAD7"
       name="citation_cad">[cite]</span>
    </p>
    
    

    <h2>References</h2>
	<div class="hangindent" id="chicago_author_date">
[Page generation failure.  The bibliography processor requires a browser with Javascript enabled.]</div>

    <div class="heading pagebreak">
       Bluebook + Chicago Fullnote Bibliography
    </div>
    
    
    <p>
      Bei un gew�ss H�mmelsbrot d\'Margr�itchen, g�t Noper bl�tzen
      Dauschen am.<sup>(1)</sup> Op dan engem Blieder Feierwon, un der
      ston zielen duerch.<sup>(2)</sup> Hin wielen heemlech m�, hu ech
      �iweg klinzecht.<sup>(3)</sup> Ass an Himmel r�schten, wee
      d\'w�iss bessert Freiesch d�, hirem d\'Leit Blieder eng
      an.<sup>(4)</sup> Si aus iwer Mamm, geet schlon op get, de Engel
      rifft gudden net.<sup>(5)</sup>
    </p>
    <p>
      Aus um fest spilt gef�llt, hun z�nne r�scht k�.<sup>(6)</sup> M�
      R�is sech gemaacht d�i, d� och Welt H�ren, ech d�nen geplot
      d\'Gaassen et.<sup>(7)</sup> Hier beschte verstoppen da ech, vill
      heemlech net um.<sup>(8)</sup> Esou Scholl schl�it un fir. Wat
      ma\'n kille d\'Hiezer wa, frou Mecht Schiet am fir.<sup>(9)</sup>
      M� r�m keng Engel bleiwe,<sup>(10)</sup> g�tt Stret geplot d� dem, d�i z�nne
      gudden l�schteg op.<sup>(11)</sup>
    </p>

    <div style="width:5em">
       <hr />
    </div>
    <div class="footnote">
      <sup>(1)</sup> <span class="fntext ir_citation" data-ir_citation_style="bluebook_demo" data-ir_citation_object="citationBB1"  data-ir_citation_abbreviations="default" id="citation1" name="citation">[book (Census) with pinpoint]</span>
    </div>
    <div class="footnote">
      <sup>(2)</sup> <span class="fntext ir_citation" data-ir_citation_style="bluebook_demo" data-ir_citation_object="citationBB2"  data-ir_citation_abbreviations="default"  id="citation2" name="citation">[book (Census) general ref] [std court decision, general ref][book (Census) pinpoint ref]
    </span>
    </div>
    <div class="footnote">
      <sup>(3)</sup> <span class="fntext ir_citation" data-ir_citation_style="bluebook_demo" data-ir_citation_object="citationBB3"  data-ir_citation_abbreviations="default"  id="citation3" name="citation">[code] [statute, session laws] [regulation]</span>
    </div>
    <div class="footnote">
      <sup>(4)</sup> <span class="fntext ir_citation" data-ir_citation_style="bluebook_demo" data-ir_citation_object="citationBB4"  data-ir_citation_abbreviations="default"  id="citation4" name="citation">[article, general ref]</span>
    </div>
    <div class="footnote">
      <sup>(5)</sup> <span class="fntext ir_citation" data-ir_citation_style="bluebook_demo" data-ir_citation_object="citationBB5"  data-ir_citation_abbreviations="default"  id="citation5" name="citation">[article, pinpoint] [code] [book D\'Arcus pinpoint] [book D\'Arcus general ref]</span>
    </div>
    <div class="footnote">
      <sup>(6)</sup> <span class="fntext ir_citation" data-ir_citation_style="bluebook_demo" data-ir_citation_object="citationBB6"  data-ir_citation_abbreviations="default"  id="citation6" name="citation">[regulation]</span>
    </div>
    <div class="footnote">
      <sup>(7)</sup> <span class="fntext ir_citation" data-ir_citation_style="bluebook_demo" data-ir_citation_object="citationBB7"  data-ir_citation_abbreviations="default"  id="citation7" name="citation">[court decision (public domain cite)]</span>
    </div>
    <div class="footnote">
      <sup>(8)</sup> <span class="fntext ir_citation" data-ir_citation_style="bluebook_demo" data-ir_citation_object="citationBB8"  data-ir_citation_abbreviations="default"  id="citation8" name="citation">[court decision (UK) year as volume]</span>
    </div>
    <div class="footnote">
      <sup>(9)</sup> <span class="fntext ir_citation" data-ir_citation_style="bluebook_demo" data-ir_citation_object="citationBB9"  data-ir_citation_abbreviations="default"  id="citation9" name="citation">[court decision (UK) with issue number]</span>
    </div>
    <div class="footnote">
      <sup>(10)</sup> <span class="fntext ir_citation" data-ir_citation_style="bluebook_demo" data-ir_citation_object="citationBB10"  data-ir_citation_abbreviations="default"  id="citation10" name="citation">[zelle] [zelle (again)]</span>
    </div>
    <div class="footnote">
      <sup>(11)</sup> <span class="fntext ir_citation" data-ir_citation_style="bluebook_demo" data-ir_citation_object="citationBB11"  data-ir_citation_abbreviations="default"  id="citation11" name="citation">[code again] [regulation]</span>
    </div>
    
    
    <h2>Bibliography</h2>
	<h3>Legal Resources</h3>
	<div class="hangindent" id="bluebook_demo_legal_stuff"></div>
	<h3>Books</h3>
	<div class="hangindent" id="bluebook_demo_books"></div>
	<h3>Articles</h3>
	<div class="hangindent" id="bluebook_demo_articles"></div>
    <div class="heading pagebreak">
       Per-author publication listing
    </div>
    <div class="dateindent"><!-- See NOTE above -->
  	  <div id="chicago_author_date_listing" class="ir_citation" data-ir_citation_style="chicago_author_date_listing" data-ir_citation_abbreviations="default" data-ir_citation_bibliography_list="chicago_author_date_listing"></div>
	</div>


    <div class="heading pagebreak">
       IEEE style ("slightly weird" abbreviations)
    </div>
	<div id="ieee" class="ir_citation" data-ir_citation_style="ieee" data-ir_citation_abbreviations="slightly_weird" data-ir_citation_bibliography_list="ieee"></div>
	
    <div class="heading pagebreak">
       Chicago Fullnote Bibliography (quotes inside punctuation, "default" abbreviations)
    </div><!--data-ir_citation_bibliography_selector="test"-->
	<div id="chicago_fullnote_bibliography2" class="ir_citation" data-ir_citation_style="chicago_fullnote_bibliography2" data-ir_citation_abbreviations="default" data-ir_citation_bibliography_list="chicago_fullnote_bibliography2">[Placeholder]</div>
  ';
}

/**
 * drupal hook to show help
 * @param $path 
 *   The path that the help is being accessed from.
 * @return $help
 *   The help string that will be returned to the user.
 */
function ir_citation_help($path, $arg) {
  $help='';//default
  
  switch ($path) {
    case 'admin/modules#description' :
    $help= t('A generic citation helper module.');
  }
  
  return $help;
}